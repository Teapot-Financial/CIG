<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Canadian Investing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Subtle, Elegant, Modern (Refined) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
        }
        /* Default (Dark) theme for body and background effects */
        body {
            background-color: #0A0A0A;
            color: #E5E7EB;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(26, 34, 53, 0.1), transparent 50%),
                        radial-gradient(circle at bottom right, rgba(18, 24, 39, 0.1), transparent 50%);
            transition: background 0.3s ease-in-out;
            z-index: 0;
        }

        /* Light theme adjustments */
        body.light-mode {
            background-color: #F9FAFB;
            color: #374151;
        }
        body.light-mode::before {
            background: radial-gradient(circle at top left, rgba(224, 247, 250, 0.5), transparent 50%),
                        radial-gradient(circle at bottom right, rgba(255, 255, 255, 0.5), transparent 50%);
        }

        #main-app-content {
            position: relative;
            z-index: 10;
        }

        /* Header/Footer Styling */
        header {
            padding: 1.5rem 0; /* Reduced padding */
        }
        header h1 {
            transition: color 0.3s ease-in-out;
        }
        header p {
            transition: color 0.3s ease-in-out;
        }
        footer {
            padding: 0.75rem 1rem;
            margin-top: 3rem;
        }

        /* Navigation Tabs */
        nav {
            padding: 0.5rem 0;
            position: sticky;
            top: 0;
            z-index: 20;
        }
        nav ul {
            flex-wrap: wrap;
        }
        nav button {
            padding: 1rem 1.25rem;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s ease-in-out;
            white-space: nowrap;
            font-weight: 500;
        }
        /* Dark Mode Tab Styles */
        body:not(.light-mode) nav button {
            color: #9CA3AF;
        }
        body:not(.light-mode) nav button:hover {
            color: #E5E7EB;
            background-color: #2D3748;
        }
        body:not(.light-mode) .tab-active {
            border-bottom-color: #6366F1; /* Indigo for active */
            color: #6366F1; /* Indigo for active text */
            font-weight: 700;
            background-color: #374151;
        }
        /* Light Mode Tab Styles */
        body.light-mode nav button {
            color: #6B7280; /* Muted for inactive tabs */
        }
        body.light-mode nav button:hover {
            color: #374151; /* Darker on hover */
            background-color: #F3F4F6; /* Slight background on hover */
        }
        body.light-mode .tab-active {
            border-bottom-color: #3B82F6; /* Vibrant blue for active */
            color: #3B82F6; /* Vibrant blue for active text */
            font-weight: 700;
            background-color: #EBF8FF; /* Slightly lighter background for active */
        }


        /* General Content Section */
        .content-section {
            display: none;
            padding: 2rem 0;
            animation: fadeIn 0.5s ease-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles (Account & Product) */
        .account-card, .product-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
            cursor: pointer;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        .account-card::before, .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 0;
        }
        .account-card:hover::before, .product-card:hover::before {
            opacity: 1;
        }
        .account-card > *, .product-card > * {
            position: relative;
            z-index: 1;
        }

        /* Product Card Icon Hover Effect */
        .product-card img {
            transition: transform 0.3s ease-in-out;
        }
        .product-card:hover img {
            transform: scale(1.1);
        }

        /* Chart & Chart Buttons */
        .chart-container {
            border-radius: 1rem;
            padding: 1.5rem;
            transition: background-color 0.3s ease-in-out;
        }
        .chart-toggle-btn {
            border: none;
            transition: all 0.3s ease-in-out;
        }
        .chart-toggle-btn:hover {
            transform: translateY(-2px);
        }

        /* Table Styling (Comparison) */
        .comparison-table {
            border-collapse: collapse;
            border-radius: 0.75rem;
            overflow: hidden;
            width: 100%;
            font-size: 0.95rem;
        }
        .comparison-table th, .comparison-table td {
            padding: 1rem;
            text-align: left;
            transition: all 0.3s ease-in-out;
        }
        .comparison-table th {
            font-weight: 600;
            font-size: 1.05rem;
        }
        .comparison-table tbody tr:hover td {
            background-color: transparent; /* Reset by default */
        }

        /* Accordion Styles */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }

        /* Glossary Section */
        #glossary-input {
            transition: all 0.3s ease-in-out;
        }
        #explain-btn {
            transition: all 0.3s ease-in-out;
        }
        #glossary-output {
            transition: all 0.3s ease-in-out;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        body:not(.light-mode) .loading-spinner {
            border-top: 4px solid #6366F1; /* Indigo spinner */
        }
        body.light-mode .loading-spinner {
            border-top: 4px solid #3B82F6;
        }

        /* Modal specific styling */
        .modal-content {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 90vh; /* Limit modal height to 90% of viewport height */
            overflow-y: auto; /* Enable vertical scrolling if content exceeds max-height */
        }
        .modal-content.show {
            transform: scale(1);
            opacity: 1;
        }

        /* Disclaimer Modal Styling */
        #disclaimer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        #disclaimer-modal-content {
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            width: 90%;
            text-align: center;
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        body:not(.light-mode) #disclaimer-modal-content {
            background-color: #1F2937;
            border: 1px solid #374151;
            box-shadow: 0 20px 25px -5px rgba(99, 102, 241, 0.1), 0 8px 10px -6px rgba(99, 102, 241, 0.05);
        }
        body.light-mode #disclaimer-modal-content {
            background-color: #ffffff;
            border: 1px solid #E5E7EB;
            box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.1), 0 8px 10px -6px rgba(59, 130, 246, 0.05);
        }
        #disclaimer-modal h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) #disclaimer-modal h2 {
            color: #6366F1;
        }
        body.light-mode #disclaimer-modal h2 {
            color: #1F2937;
        }
        #disclaimer-modal p {
            font-size: 1rem;
            line-height: 1.625;
            margin-bottom: 2rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) #disclaimer-modal p {
            color: #D1D5DB;
        }
        body.light-mode #disclaimer-modal p {
            color: #4B5563;
        }
        #disclaimer-modal button {
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }
        body:not(.light-mode) #disclaimer-modal button {
            background-color: #6366F1;
            color: #ffffff;
        }
        body:not(.light-mode) #disclaimer-modal button:hover {
            background-color: #4F46E5;
        }
        body.light-mode #disclaimer-modal button {
            background-color: #3B82F6;
            color: #ffffff;
        }
        body.light-mode #disclaimer-modal button:hover {
            background-color: #2563EB;
        }


        /* Infographic specific styling (reused from considerations styling for consistency) */
        .infographic-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        .infographic-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        body:not(.light-mode) .infographic-card {
            background: linear-gradient(135deg, #1F2937 0%, #2D3748 100%);
            border: 1px solid #374151;
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.05);
        }
        body.light-mode .infographic-card {
            background: linear-gradient(to bottom right, #FFFFFF, #EBF8FF);
            border: 1px solid #BFDBFE;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.05);
        }
        .infographic-card .icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .infographic-card .icon {
            color: #6366F1; /* Indigo tint for icons in dark mode */
        }
        body.light-mode .infographic-card .icon {
            color: #60A5FA; /* Blue tint for icons in light mode */
        }
        .infographic-card h4 {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .infographic-card h4 {
            color: #E5E7EB;
        }
        body.light-mode .infographic-card h4 {
            color: #374151;
        }
        .infographic-card p {
            font-size: 0.9rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .infographic-card p {
            color: #D1D5DB;
        }
        body.light-mode .infographic-card p {
            color: #4B5563;
        }

        /* Product Dashboard Specific Styles */
        .product-dashboard-section {
            display: none;
        }
        .product-dashboard-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        .product-dashboard-nav button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }
        body:not(.light-mode) .product-dashboard-nav button {
            background-color: #374151;
            color: #D1D5DB;
        }
        body:not(.light-mode) .product-dashboard-nav button:hover {
            background-color: #4B5563;
            color: #E5E7EB;
        }
        body:not(.light-mode) .product-dashboard-nav button.active-product-tab {
            background-color: #6366F1;
            color: #FFFFFF;
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }
        body.light-mode .product-dashboard-nav button {
            background-color: #F3F4F6;
            color: #6B7280;
        }
        body.light-mode .product-dashboard-nav button:hover {
            background-color: #E5E7EB;
            color: #374151;
        }
        body.light-mode .product-dashboard-nav button.active-product-tab {
            background-color: #3B82F6;
            color: #FFFFFF;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .product-info-card {
            border-radius: 1rem;
            padding: 2rem;
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        body:not(.light-mode) .product-info-card {
            background-color: #1F2937;
            border: 1px solid #374151;
        }
        body.light-mode .product-info-card {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
        }

        .product-info-card h3 {
            font-weight: 700;
            margin-bottom: 1rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .product-info-card h3 {
            color: #6366F1;
        }
        body.light-mode .product-info-card h3 {
            color: #3B82F6;
        }

        .product-info-card p, .product-info-card ul, .product-info-card ol, .product-info-card li {
            line-height: 1.6;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .product-info-card p,
        body:not(.light-mode) .product-info-card ul,
        body:not(.light-mode) .product-info-card ol,
        body:not(.light-mode) .product-info-card li {
            color: #D1D5DB;
        }
        body.light-mode .product-info-card p,
        body.light-mode .product-info-card ul,
        body.light-mode .product-info-card ol,
        body.light-mode .product-info-card li {
            color: #4B5563;
        }
        .product-info-card strong {
            font-weight: 600;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .product-info-card strong {
            color: #E5E7EB;
        }
        body.light-mode .product-info-card strong {
            color: #374151;
        }

        .chart-container-product-details {
            min-height: 300px; /* Ensure chart has space */
            max-height: 400px;
            width: 100%;
        }

        .news-item {
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        body:not(.light-mode) .news-item {
            background-color: #2D3748;
            border: 1px solid #4B5563;
        }
        body.light-mode .news-item {
            background-color: #F9FAFB;
            border: 1px solid #E0E7FF;
        }
        .news-item h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .news-item h4 {
            color: #E5E7EB;
        }
        body.light-mode .news-item h4 {
            color: #374151;
        }
        .news-item p {
            font-size: 0.85rem;
            transition: color 0.3s ease-in-out;
        }
        body:not(.light-mode) .news-item p {
            color: #9CA3AF;
        }
        body.light-mode .news-item p {
            color: #6B7280;
        }
        .product-chart-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        @media (min-width: 768px) {
            .product-chart-wrapper {
                flex-direction: row;
            }
            .product-chart-wrapper > div {
                flex: 1;
            }
        }
    </style>
</head>
<body>

    <!-- Disclaimer Modal -->
    <div id="disclaimer-modal">
        <div id="disclaimer-modal-content">
            <h2>Important Disclaimer</h2>
            <p>This interactive guide provides general information about Canadian investment products and strategies for educational purposes only. It is not intended as financial advice. Investment involves risks, and past performance is not indicative of future results.</p>
            <p>Always conduct your own research and consider consulting with a qualified financial advisor before making any investment decisions. Your individual financial situation, risk tolerance, and goals should always be taken into account.</p>
            <button id="acknowledge-disclaimer">I Understand & Acknowledge</button>
        </div>
    </div>

    <!-- Main Application Content -->
    <div id="main-app-content">
        <div class="container mx-auto p-4 md:p-8">

            <header class="text-center mb-10">
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-4xl md:text-5xl font-extrabold mb-2 flex-grow">Your Guide to Investing in Canada</h1>
                    <button id="dark-mode-toggle" class="p-3 rounded-full shadow-md transition-colors duration-300" aria-label="Toggle dark mode">
                        <!-- Icon will be set by JavaScript -->
                    </button>
                </div>
                <p class="text-lg mt-2">An interactive resource for newcomers.</p>
            </header>

            <nav class="border-b mb-8 rounded-t-lg shadow-md">
                <ul class="flex flex-wrap -mb-px justify-center text-sm font-medium text-center">
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg tab-active" data-tab="accounts-and-compare">Account Types</button>
                    </li>
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="explore-investments">Explore Investments</button>
                    </li>
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="investing-principles">Investing Principles</button>
                    </li>
                    <li class="mr-2">
                        <button class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="ai-glossary">AI Glossary</button>
                    </li>
                     <li>
                        <button class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive" data-tab="our-recommendation">Our Recommendation</button>
                    </li>
                </ul>
            </nav>

            <main>
                <section id="accounts-and-compare" class="content-section active">
                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Registered Accounts: The Tax-Advantaged Buckets</h2>
                        <p class="text-gray-600">Canada offers special accounts with unique tax benefits to help you save for specific goals. Click on any account below to learn more about its purpose, how it works, and its key features.</p>
                    </div>
                    <div id="accounts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                    </div>

                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Compare Accounts Side-by-Side</h2>
                        <p class="text-gray-600">Understanding the nuances between registered accounts is key. Use the buttons below the chart to visualize different comparison metrics, and refer to the detailed table for a comprehensive overview.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-8">
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        <div class="flex flex-wrap justify-center gap-2 mt-6">
                            <button class="chart-toggle-btn bg-gray-700 text-white py-2 px-4 rounded-lg shadow hover:bg-gray-800" data-type="contribution">Contribution Taxability</button>
                            <button class="chart-toggle-btn bg-gray-400 text-white py-2 px-4 rounded-lg shadow hover:bg-gray-500" data-type="withdrawal">Withdrawal Taxability</button>
                            <button class="chart-toggle-btn bg-gray-400 text-white py-2 px-4 rounded-lg shadow hover:bg-gray-500" data-type="annual-limit">Annual Contribution Limits</button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                        <h3 class="text-2xl font-bold mb-4 text-center">Detailed Account Comparison Table</h3>
                        <div id="comparison-table-container">
                            <!-- Table will be rendered here by JavaScript -->
                        </div>
                        <p class="text-sm text-gray-600 mt-4 text-center">
                            <em>Note: Contribution limits are based on current (2024) figures and can change annually. RRSP contribution room is based on 18% of prior year's earned income up to the annual maximum. TFSA cumulative room varies by individual.</em>
                        </p>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 mt-8">
                        <h3 class="text-2xl font-bold mb-4 text-center">When to Prioritize Each Account</h3>
                        <div class="space-y-4 text-gray-700">
                            <p><strong class="font-semibold text-gray-800">FHSA:</strong> Ideal if you are a **first-time home buyer** in Canada planning to purchase a home within the next 15 years. It offers the best of both worlds: tax-deductible contributions (like an RRSP) and tax-free withdrawals for a home purchase (like a TFSA).</p>
                            <p><strong class="font-semibold text-gray-800">TFSA:</strong> Excellent for **any financial goal** due to completely tax-free growth and withdrawals. Prioritize if you anticipate being in a higher tax bracket in the future than you are now, or for flexible savings like an emergency fund or short-to-medium term goals.</p>
                            <p><strong class="font-semibold text-gray-800">RRSP:</strong> Best for **long-term retirement savings**, especially if you are currently in a **higher income tax bracket** and expect to be in a lower one during retirement. The immediate tax deduction can be very beneficial.</p>
                        </div>
                    </div>
                </section>

                <section id="explore-investments" class="content-section">
                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Explore Investment Products & Management Styles</h2>
                        <p class="text-gray-600">Once you've chosen an account (the "bucket"), you need to decide what to put inside it (the "products") and who will manage it. We recommend starting with <strong>Robo-Advisors</strong> if you're new. Click on "Management Styles" below to learn why. Then, delve into specific product types using the navigation buttons below.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                        <div id="investment-products">
                            <h3 class="text-2xl font-bold mb-4 text-center">Investment Products</h3>
                            <!-- Investment product accordions will be rendered here -->
                        </div>
                        <div id="management-styles">
                             <h3 class="text-2xl font-bold mb-4 text-center">Management Styles</h3>
                            <!-- Management style accordions will be rendered here -->
                        </div>
                    </div>

                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Deep Dive: Investment Products Explained</h2>
                        <p class="text-gray-600">Explore the details of GICs, Mutual Funds, ETFs, Stocks, and Bonds. Understand their characteristics, performance, and how to invest.</p>
                    </div>

                    <div class="flex justify-center flex-wrap gap-3 mb-8 product-dashboard-nav">
                        <button class="active-product-tab" data-product="gics">GICs</button>
                        <button data-product="mutual-funds">Mutual Funds</button>
                        <button data-product="etfs">ETFs</button>
                        <button data-product="stocks">Stocks</button>
                        <button data-product="bonds">Bonds</button>
                    </div>

                    <div id="product-dashboard-content" class="space-y-8">
                        <!-- Content for each product will be rendered here -->
                    </div>
                </section>

                <section id="our-recommendation" class="content-section">
                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Our Recommendation for a Newcomer</h2>
                        <p class="text-gray-600">Based on the options, here is a suggested path for a newcomer to get started with investing in Canada. This approach prioritizes flexibility and long-term growth.</p>
                    </div>
                     <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-lg border border-gray-100">
                        <div id="recommendation-content"></div>
                    </div>
                </section>

                <section id="ai-glossary" class="content-section">
                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">AI-Powered Investment Glossary ✨</h2>
                        <p class="text-gray-600">Have a financial term you don't understand? Enter it below and let our AI provide a concise explanation for you!</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md max-w-2xl mx-auto border border-gray-100">
                        <div class="flex items-center mb-4">
                            <input type="text" id="glossary-input" placeholder="e.g., Diversification, Capital Gains" class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500">
                            <button id="explain-btn" class="ml-4 bg-gray-700 text-white py-3 px-6 rounded-lg shadow hover:bg-gray-800 flex items-center justify-center">
                                Explain Term
                                <div id="loading-spinner" class="loading-spinner hidden"></div>
                            </button>
                        </div>
                        <div id="glossary-output" class="p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px] text-gray-700">
                            <p class="text-center text-gray-500">Your explanation will appear here.</p>
                        </div>
                    </div>
                </section>

                <section id="investing-principles" class="content-section">
                    <div class="text-center mb-8 max-w-3xl mx-auto">
                        <h2 class="text-3xl font-bold mb-2">Quick Guide: Essential Investing Principles 📊</h2>
                        <p class="text-gray-600">A visual summary of the key considerations every new investor should know.</p>
                    </div>
                    <div id="infographic-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                        <!-- Infographic cards will be dynamically rendered here -->
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- Static Footer Disclaimer -->
    <footer class="bg-gray-100 text-gray-600 text-xs py-3 px-4 text-center mt-12 border-t border-gray-200">
        <div class="max-w-5xl mx-auto">
            <p><strong>Disclaimer:</strong> This guide is for informational and educational purposes only and does not constitute financial advice. Investment involves risks, and past performance is not a guarantee of future results. Always consult with a qualified financial professional before making investment decisions.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Data Definitions (Updated with new chart-specific limits and table data) ---
    const accountData = {
        fhsa: {
            title: "FHSA",
            fullName: "First Home Savings Account",
            purpose: "A powerful account to save for a down payment on a first home.",
            annualContributionLimit: 8000, // For chart
            lifetimeContributionLimit: 40000, // For chart
            details: [
                { title: "Contributions", text: "Tax-deductible, reducing your taxable income for the year. Annual limit of $8,000, lifetime limit of $40,000." },
                { title: "Growth", text: "Grows completely tax-free, like a TFSA." },
                { title: "Withdrawals", text: "Completely tax-free when used for a qualifying first home purchase." },
                { title: "Time Limit", text: "Must be used within 15 years of opening or by age 71. Unused funds can be transferred to an RRSP/RRIF." }
            ],
            features: [
                 { title: "Best of Both Worlds", text: "Combines the tax deduction of an RRSP with the tax-free withdrawal of a TFSA for a home purchase." }
            ]
        },
        rrsp: {
            title: "RRSP",
            fullName: "Registered Retirement Savings Plan",
            purpose: "Primarily designed for long-term retirement savings.",
            annualContributionLimit: 31560, // 2024 maximum for charting
            lifetimeContributionLimit: 'Variable (based on unused room)', // For table, not a single chart value
            details: [
                { title: "Contributions", text: "Tax-deductible, reducing your taxable income for the year. Based on 18% of prior year's earned income, up to $31,560 (2024)." },
                { title: "Growth", text: "Investments grow tax-deferred until withdrawal." },
                { title: "Withdrawals", text: "Fully taxable as income when withdrawn, ideally at a lower tax rate in retirement." },
                { title: "Maturity", text: "Must be converted to a RRIF or annuity by the end of the year you turn 71." }
            ],
            features: [
                { title: "Home Buyer's Plan (HBP)", text: "Withdraw up to $35,000 tax-free for a first home, repayable over 15 years." },
                { title: "Lifelong Learning Plan (LLP)", text: "Withdraw up to $20,000 tax-free for education, repayable over 10 years." }
            ]
        },
        tfsa: {
            title: "TFSA",
            fullName: "Tax-Free Savings Account",
            purpose: "A highly flexible account for almost any savings goal.",
            annualContributionLimit: 7000, // 2024 limit
            lifetimeContributionLimit: 95000, // Cumulative for someone 18+ since 2009 up to 2024
            details: [
                { title: "Contributions", text: "Not tax-deductible. Made with after-tax money. Annual limit of $7,000 (2024). Cumulative room starts at age 18 (e.g., $95,000 as of 2024 if eligible since 2009)." },
                { title: "Growth", text: "Investment income and capital gains are completely tax-free, for life." },
                { title: "Withdrawals", text: "Completely tax-free, anytime, for any reason. Withdrawn amount is added back to contribution room the next year." },
                { title: "Age Limit", text: "None. Can be held for your entire life." }
            ],
            features: [
                { title: "Major Benefit", text: "The power of tax-free compounding is incredible for long-term growth." }
            ]
        },
        resp: {
            title: "RESP",
            fullName: "Registered Education Savings Plan",
            purpose: "To save for a child's post-secondary education.",
            annualContributionLimit: 'No annual limit, but grants max out at $2,500/year', // For table
            lifetimeContributionLimit: 50000, // Lifetime contribution limit
            details: [
                { title: "Contributions", text: "Not tax-deductible." },
                { title: "Growth", text: "Grows tax-deferred." },
                { title: "Government Grants", text: "The Canada Education Savings Grant (CESG) matches 20% of contributions up to $500 per year, up to a lifetime maximum per child." },
                { title: "Withdrawals", text: "Growth and grants are taxed in the hands of the student, who typically pays little to no tax." }
            ],
            features: []
        },
        rdsp: {
            title: "RDSP",
            fullName: "Registered Disability Savings Plan",
            purpose: "To help individuals with disabilities save for the long term.",
            annualContributionLimit: 'No annual limit', // For table
            lifetimeContributionLimit: 200000, // Lifetime contribution limit
            details: [
                { title: "Contributions", text: "Not tax-deductible." },
                { title: "Growth", text: "Grows tax-sheltered." },
                { title: "Government Grants", "text": "Benefits from generous government grants and bonds." }
            ],
            features: []
        },
        nonRegistered: {
            title: "Non-Registered",
            fullName: "Non-Registered Account",
            purpose: "For investing after you've maxed out registered accounts.",
            annualContributionLimit: 'None', // For table
            lifetimeContributionLimit: 'None', // For table
            details: [
                { title: "Contributions", text: "No tax deduction and no contribution limits." },
                { title: "Growth", text: "All investment income (interest, dividends, capital gains) is taxable in the year it is earned." },
                { title: "Withdrawals", "text": "No tax on withdrawal of principal, but realized capital gains are taxed." }
            ],
            features: []
        }
    };

    // Simplified product data for the "How to Invest" section accordions
    const productData = [
        {
            title: "Cash / High-Interest Savings Accounts (HISAs)",
            description: `
                <p><strong>What they are:</strong> A very low-risk way to save money. Your funds are easily accessible, making them ideal for short-term needs like an emergency fund.</p>
                <p><strong>Risk Level:</strong> Very Low</p>
            `
        },
        {
            title: "Guaranteed Investment Certificates (GICs)",
            description: `
                <p><strong>What they are:</strong> A low-risk investment where you lend money to a financial institution for a set period at a fixed interest rate. Your principal is guaranteed.</p>
                <p><strong>Risk Level:</strong> Very Low</p>
            `
        },
        {
            title: "Mutual Funds",
            description: `
                <p><strong>What they are:</strong> A pool of money from many investors, managed by a professional fund manager, invested in a diversified portfolio of stocks, bonds, or other securities. They aim to outperform a specific benchmark.</p>
                <p><strong>Risk Level:</strong> Varies (Low to High, depending on fund's holdings)</p>
            `
        },
        {
            title: "Exchange-Traded Funds (ETFs)",
            description: `
                <p><strong>What they are:</strong> Similar to mutual funds, but they trade like stocks on a stock exchange. Most ETFs are designed to track a specific index (e.g., S&P/TSX Composite Index) rather than actively manage a portfolio.</p>
                <p><strong>Risk Level:</strong> Varies (Medium to High, depending on underlying assets)</p>
            `
        },
        {
            title: "Stocks (Equities)",
            description: `
                <p><strong>What they are:</strong> Represents ownership in a publicly traded company. When you buy a stock, you own a small piece of that company. Their value can increase (capital gains) and may pay dividends.</p>
                <p><strong>Risk Level:</strong> High</p>
            `
        },
        {
            title: "Bonds",
            description: `
                <p><strong>What they are:</strong> Essentially, lending money to a government or corporation. In return, you receive regular interest payments, and your principal is returned at maturity. They are considered less risky than stocks.</p>
                <p><strong>Risk Level:</strong> Low to Medium (depending on issuer and term)</p>
            `
        }
    ];

    // Management styles data remains the same
    const managementData = [
        {
            title: "Self-Directed Investing (DIY)",
            description: `
                <p><strong>What it is:</strong> You take full control of your investments. You open an account with a discount brokerage and decide which stocks, ETFs, GICs, or mutual funds to buy and sell. This requires active management and research on your part.</p>
                <p><strong>Examples of Platforms:</strong></p>
                <ul class="list-disc list-inside ml-4">
                    <li>RBC Direct Investing</li>
                    <li>TD Direct Investing</li>
                    <li>BMO InvestorLine</li>
                    <li>Scotia iTRADE</li>
                    <li>CIBC Investor's Edge</li>
                    <li>Questrade</li>
                </ul>
                <p><strong>Fees:</strong> Typically the lowest fees, mainly trading commissions (which can be $0 for ETFs at many platforms) plus the fees of the underlying investments (e.g., ETF MERs). Account administration fees might apply if your balance is below a certain threshold.</p>
                <p><strong>Best For:</strong> Investors who are knowledgeable, disciplined, and have the time and interest to actively manage their own portfolios.</p>
            `
        },
        {
            title: "Robo-Advisors (Hybrid Approach)",
            description: `
                <p><strong>What it is:</strong> An online investment management service that uses algorithms to build and manage a diversified portfolio of low-cost ETFs tailored to your risk tolerance and goals. You typically answer a questionnaire, and they recommend and manage a suitable portfolio.</p>
                <p><strong>Examples of Services:</strong></p>
                <ul class="list-disc list-inside ml-4">
                    <li>RBC InvestEase</li>
                    <li>Wealthsimple Invest</li>
                    <li>Questwealth Portfolios (Questrade)</li>
                    <li>BMO SmartFolio</li>
                    <li>TD Automated Investing</li>
                    <li>CI Direct Investing</li>
                </ul>
                <p><strong>Fees:</strong> Generally low. Management fees typically range from 0.25% to 0.50% of your assets annually. When including the fees of the underlying ETFs, the all-in cost is often between 0.5% and 0.8% per year. For example, RBC InvestEase has a management fee of 0.5%.</p>
                <p><strong>Historical Returns:</strong> For a balanced portfolio, robo-advisors generally track broad market performance, minus their fees. For example, RBC InvestEase's balanced portfolio showed annualized returns of roughly 6-13% over various periods (1-5 years, as of late 2024), reflecting market movements.</p>
                <p><strong>Best For:</strong> New investors, those who prefer a hands-off approach, or individuals who want diversified portfolios at a lower cost than traditional advisors.</p>
            `
        },
        {
            title: "Full-Service Financial Advisors",
            description: `
                <p><strong>What it is:</strong> You work with a human financial advisor who provides personalized financial planning, investment advice, and manages your portfolio. They offer comprehensive services, including retirement planning, tax strategies, and estate planning.</p>
                <p><strong>Examples of Services:</strong></p>
                <ul class="list-disc list-inside ml-4">
                    <li>RBC Dominion Securities</li>
                    <li>BMO Nesbitt Burns</li>
                    <li>ScotiaMcLeod (Scotiabank)</li>
                    <li>TD Wealth Private Client Group</li>
                    <li>CI Assante Wealth Management</li>
                    <li>IG Wealth Management</li>
                </ul>
                <p><strong>Fees:</strong> Generally the highest fees. Management fees can range from 1% to 2% or more of your assets under management annually, in addition to the fees of the underlying investment products (e.g., mutual fund MERs). These fees are for the comprehensive advice and hands-on management provided.</p>
                <p><strong>Best For:</strong> Individuals with complex financial situations, those who prefer hands-on guidance, or who are uncomfortable making investment decisions themselves.</p>
            `
        }
    ];

    // NEW: Detailed Product Data with Images and Short Descriptions (Updated colors)
    const detailedProductData = [
        {
            title: "High-Interest Savings Accounts (HISAs)",
            shortDescription: "Very low-risk, highly liquid savings for short-term goals or emergency funds.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=HISA", /* Match account cards background, gray text */
            content: `
                <p>HISAs offer a higher interest rate than traditional savings accounts, making them suitable for emergency funds or short-term savings goals. They are very low risk and liquid.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Examples in Canada:</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>EQ Bank Personal Account (often among the highest rates)</li>
                    <li>Simplii Financial High Interest Savings Account</li>
                    <li>Tangerine Savings Account</li>
                    <li>BMO Savings Amplifier Account (often promotional rates)</li>
                    <li>RBC High Interest eSavings Account (often promotional rates)</li>
                    <li>Scotiabank MomentumPLUS Savings Account (often promotional rates)</li>
                    <li>CIBC eAdvantage Savings Account (often promotional rates)</li>
                    <li>Manulife Bank Advantage Account</li>
                    <li>Oaken Financial Savings Account</li>
                    <li>Neo Financial High-Interest Savings Account</li>
                </ul>
                <p class="mt-4"><strong>Typical Current Rates:</strong> 2% - 5% (often includes promotional bonuses for new money).
                <p class="mt-2 text-sm text-gray-500"><em>Note: HISA rates fluctuate with the Bank of Canada's overnight rate. Historically, long-term rates have been much lower than current promotional rates.</em></p>
            `
        },
        {
            title: "Guaranteed Investment Certificates (GICs)",
            shortDescription: "Fixed interest rate, principal guaranteed, for predictable returns.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=GIC", /* Match account cards background, gray text */
            content: `
                <p>GICs are investments that guarantee your principal and offer a fixed rate of return over a set period. They are very low risk but less flexible than HISAs.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Common Types and Examples:</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Non-Redeemable GICs:</strong> Most common. Cannot be cashed before maturity without penalty.
                        <ul class="list-circle list-inside ml-8">
                            <li>RBC Non-Redeemable GICs (various terms)</li>
                            <li>TD Fixed Rate GICs (various terms)</li>
                            <li>EQ Bank GICs (competitive rates for various terms)</li>
                        </ul>
                    </li>
                    <li><strong>Cashable/Redeemable GICs:</strong> Can be cashed before maturity, usually after a waiting period (e.g., 30-90 days), but often offer a lower interest rate.
                        <ul class="list-circle list-inside ml-8">
                            <li>BMO Cashable GIC</li>
                            <li>Scotiabank Redeemable GIC</li>
                        </ul>
                    </li>
                    <li><strong>Market-Linked GICs:</strong> Principal is guaranteed, but returns are tied to the performance of an underlying index (e.g., stock market). May have potential for higher returns but also a minimum guaranteed return of 0%.
                        <ul class="list-circle list-inside ml-8">
                            <li>RBC Equity-Linked GICs</li>
                            <li>TD Canadian Banks GIC</li>
                        </ul>
                    </li>
                </ul>
                <p class="mt-4"><strong>Typical Current Rates (Non-Redeemable):</strong>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>1-Year GIC: 2.55% - 3.65%</li>
                    <li>3-Year GIC: 2.65% - 3.70%</li>
                    <li>5-Year GIC: 2.75% - 3.95%</li>
                    <li>10-Year GIC: Around 3.25% - 3.35%</li>
                </ul>
                <p class="mt-2 text-sm text-gray-500"><em>Note: GIC rates vary by financial institution and term. Always compare offers.</em></p>
            `
        },
        {
            title: "Mutual Funds",
            shortDescription: "Professionally managed diversified portfolios, but often with higher fees.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=Mutual+Funds", /* Match account cards background, gray text */
            content: `
                <p>Mutual funds are professionally managed pools of money invested in various securities. They offer diversification and professional expertise but typically come with higher fees.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Examples of Popular Categories/Funds in Canada:</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Canadian Equity Funds:</strong> Invest in Canadian stocks.
                        <ul class="list-circle list-inside ml-8">
                            <li>Mawer Canadian Equity Fund</li>
                            <li>RBC Canadian Equity Fund</li>
                            <li>TD Canadian Equity Fund</li>
                        </ul>
                    </li>
                    <li><strong>Canadian Fixed Income/Bond Funds:</strong> Invest in Canadian bonds.
                        <ul class="list-circle list-inside ml-8">
                            <li>CIBC Canadian Bond Fund</li>
                            <li>RBC Bond Fund</li>
                        </ul>
                    </li>
                    <li><strong>Balanced Funds:</strong> A mix of stocks and bonds, aiming for growth and income.
                        <ul class="list-circle list-inside ml-8">
                            <li>Mawer Balanced Fund</li>
                            <li>RBC Select Balanced Portfolio</li>
                            <li>TD Balanced Fund</li>
                        </ul>
                    </li>
                    <li><strong>Global/International Equity Funds:</strong> Invest in stocks outside of Canada.
                        <ul class="list-circle list-inside ml-8">
                            <li>Mawer International Equity Fund</li>
                            <li>RBC Global Equity Fund</li>
                        </ul>
                    </li>
                </ul>
                <p class="mt-4"><strong>Typical Management Expense Ratios (MERs):</strong>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Actively Managed Canadian Equity Funds: Average ~2.45% annually</li>
                    <li>Actively Managed Fixed Income Funds: Average ~1.62% annually</li>
                    <li>Mawer Balanced Fund (lower end): ~0.91% annually</li>
                </ul>
                <p class="mt-4"><strong>Historical Performance:</strong> Varies greatly by fund and market conditions. Many actively managed mutual funds historically struggle to outperform their benchmarks after factoring in their higher fees over the long term. For example, a well-managed balanced fund might aim for annualized returns of 5-8% over the long term, but actual results can differ significantly.</p>
                <p class="mt-2 text-sm text-gray-500"><em>Note: High MERs can significantly reduce your net returns over time.</em></p>
            `
        },
        {
            title: "Exchange-Traded Funds (ETFs)",
            shortDescription: "Diversified baskets of investments that trade like stocks, with low fees.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=ETFs", /* Match account cards background, gray text */
            content: `
                <p>ETFs are collections of investments that trade on stock exchanges, similar to individual stocks. Most ETFs are passively managed, meaning they aim to track a specific index, resulting in lower fees and broad diversification.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Examples of Popular ETFs (Canadian-listed):</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Canadian Equity ETFs (tracking TSX Composite):</strong>
                        <ul class="list-circle list-inside ml-8">
                            <li>Vanguard FTSE Canada Index ETF (VCE) - MER: 0.06%</li>
                            <li>iShares Core S&P/TSX Capped Composite Index ETF (XIC) - MER: 0.06%</li>
                            <li>BMO S&P/TSX Capped Composite Index ETF (ZCN) - MER: 0.06%</li>
                        </ul>
                    </li>
                    <li><strong>US Equity ETFs (tracking S&P 500 - Canadian-listed, CAD or CAD-hedged):</strong>
                        <ul class="list-circle list-inside ml-8">
                            <li>Vanguard S&P 500 Index ETF (VFV) - MER: 0.08% (CAD unhedged)</li>
                            <li>iShares Core S&P 500 Index ETF (XUS) - MER: 0.10% (CAD unhedged)</li>
                            <li>BMO S&P 500 Index ETF (ZSP) - MER: 0.09% (CAD unhedged)</li>
                            <li>Vanguard S&P 500 Index ETF (CAD-hedged) (VSP) - MER: 0.08% (CAD hedged)</li>
                        </ul>
                    </li>
                    <li><strong>US Total Market ETFs (Canadian-listed):</strong>
                        <ul class="list-circle list-inside ml-8">
                            <li>Vanguard US Total Market Index ETF (VUN) - MER: 0.17% (CAD unhedged)</li>
                        </ul>
                    </li>
                    <li><strong>Canadian Bond ETFs:</strong>
                        <ul class="list-circle list-inside ml-8">
                            <li>Vanguard Canadian Aggregate Bond Index ETF (VAB) - MER: 0.08%</li>
                            <li>iShares Core Canadian Universe Bond Index ETF (XBB) - MER: 0.19%</li>
                        </ul>
                    </li>
                    <li><strong>All-in-One Asset Allocation ETFs (convenient diversified portfolios):</strong>
                        <ul class="list-circle list-inside ml-8">
                            <li>Vanguard All-Equity ETF Portfolio (VEQT) - MER: 0.24%</li>
                            <li>Vanguard Balanced ETF Portfolio (VBAL) - MER: 0.24%</li>
                            <li>iShares Core Growth ETF Portfolio (XGRO) - MER: 0.20%</li>
                        </ul>
                    </li>
                </ul>
                <p class="mt-4"><strong>Typical Management Expense Ratios (MERs):</strong> Very low, generally 0.05% to 0.50% for broad market index ETFs.</p>
                <p class="mt-4"><strong>Historical Performance:</strong>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>ETFs tracking TSX Composite Index (Canadian Equity):</strong> Historically averaged ~7-9% annualized returns over long periods. More recently, the TSX Composite had a YTD return of around 7.92% (as of June 10, 2025) and a 10-year annualized return of ~8.93% (as of June 9, 2025).</li>
                    <li><strong>ETFs tracking S&P 500 Index (US Equity):</strong> Historically averaged >10% annualized returns over long periods. More recently, the S&P 500 had a 5-year CAGR of ~14.49% and a 10-year CAGR of ~10.17% (as of May 2025).</li>
                </ul>
                <p class="mt-2 text-sm text-gray-500"><em>Note: Performance figures for specific ETFs will closely mirror their underlying index, minus the MER. Currency hedging affects returns.</em></p>
            `
        },
        {
            title: "Stocks (Equities)",
            shortDescription: "Ownership in a company, offering high growth potential but also higher risk.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=Stocks", /* Match account cards background, gray text */
            content: `
                <p>Investing in individual stocks means buying ownership in a specific company. This can offer high growth potential but also carries higher risk compared to diversified funds.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Examples of Companies (across sectors, popular in Canada/US):</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Canadian Banks:</strong> Royal Bank of Canada (RY), Toronto-Dominion Bank (TD), Bank of Montreal (BMO), Bank of Nova Scotia (BNS) - generally stable, dividend-paying.</li>
                    <li><strong>Canadian Energy:</strong> Enbridge Inc. (ENB), Canadian Natural Resources (CNQ), Suncor Energy (SU) - tied to commodity prices.</li>
                    <li><strong>Canadian Tech/Growth:
                    Shopify Inc. (SHOP), Constellation Software Inc. (CSU) - higher growth potential, often more volatile.
                    </strong></li>
                    <li><strong>US Tech Giants:</strong> Apple Inc. (AAPL), Microsoft Corp. (MSFT), NVIDIA Corp. (NVDA), Amazon.com Inc. (AMZN), Meta Platforms Inc. (META) - dominant global companies, high growth, but also subject to market swings.</li>
                    <li><strong>Canadian Utilities:</strong> Fortis Inc. (FTS), Hydro One Ltd. (H) - generally stable, regulated companies often paying dividends.</li>
                </ul>
                <p class="mt-4"><strong>Historical Performance (Market Benchmarks):</strong>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>S&P/TSX Composite Index (Canadian Stock Market):</strong> Has historically averaged annualized returns of approximately 7-9% over very long periods (e.g., 50+ years).</li>
                    <li><strong>S&P 500 Index (U.S. Stock Market):</strong> Has historically delivered average annual returns of over 10% since 1957.</li>
                </ul>
                <p class="mt-2 text-sm text-gray-500"><em>Note: Individual stock performance can deviate significantly from market averages. Diversification across many stocks or investing in equity ETFs is generally recommended to mitigate individual company risk.</em></p>
            `
        },
        {
            title: "Bonds",
            shortDescription: "Lending money to governments or corporations for regular interest payments.",
            image: "https://placehold.co/150x100/E0E7FF/4B5563?text=Bonds", /* Match account cards background, gray text */
            content: `
                <p>Bonds represent a loan made by an investor to a borrower (typically a government or corporation). In return, the investor receives regular interest payments and repays the principal at maturity. Generally considered less risky than stocks.</p>
                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Types and Examples:</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Government Bonds:</strong> Issued by federal, provincial, or municipal governments. Considered very low risk, especially federal bonds.
                        <ul class="list-circle list-inside ml-8">
                            <li>Government of Canada Bonds (e.g., 5-year, 10-year bonds)</li>
                            <li>Provincial Government Bonds (e.g., Ontario Bonds)</li>
                        </ul>
                    </li>
                    <li><strong>Corporate Bonds:</strong> Issued by companies. Carry more risk than government bonds but typically offer higher interest rates.
                        <ul class="list-circle list-inside ml-8">
                            <li>Bonds from major Canadian corporations (e.g., Bell Canada, Enbridge)</li>
                            <li>Investment-grade corporate bonds (higher credit rating, lower risk)</li>
                            <li>High-yield (junk) bonds (lower credit rating, higher risk, higher potential return)</li>
                        </ul>
                    </li>
                    <li><strong>Real Return Bonds (RRBs):</strong> Government bonds whose principal and interest payments are adjusted for inflation.
                        <ul class="list-circle list-inside ml-8">
                            <li>Government of Canada Real Return Bonds</li>
                        </ul>
                    </li>
                </ul>
                <p class="mt-4"><strong>Typical Yields / Historical Performance:</strong>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Canadian Government Bonds:</strong> Current yields on 5-year Government of Canada benchmark bonds are around 2.96% (as of June 6, 2025). Long-term historical returns have generally been in the 2-4% annualized range.</li>
                    <li><strong>Canadian Corporate Bonds:</strong> Generally offer slightly higher yields than government bonds, often 0.5% - 1.5% higher depending on the issuer's credit quality and bond term. Funds tracking corporate bonds have seen returns like 1.31% YTD, 7.07% (2024), 8.16% (2023).</li>
                </ul>
                <p class="mt-2 text-sm text-gray-500"><em>Note: Bond prices move inversely to interest rates. When interest rates rise, existing bond prices typically fall, and vice versa.</em></p>
            `
        }
    ];

    // --- Product Details Dashboard Data ---
    // Helper function to generate simulated data for 20 years
    function generateSimulatedData(startValue, years, volatilityFactor, growthFactor) {
        let data = [startValue];
        for (let i = 1; i < years; i++) {
            let lastValue = data[i - 1];
            // Simple random walk with a drift (growthFactor) and some noise (volatilityFactor)
            let change = (Math.random() - 0.5) * volatilityFactor + growthFactor;
            data.push(Math.max(0, lastValue * (1 + change / 100))); // Ensure value doesn't go below 0
        }
        return data;
    }

    // Helper to generate distinct colors
    function getChartColors(numColors) {
        const colors = [
            '#6366F1', '#3B82F6', '#8B5CF6', '#EC4899', '#10B981', '#F59E0B', '#EF4444', '#0EA5E9', '#A855F7', '#D946EF',
            '#4ADE80', '#FACC15', '#F97316', '#DC2626', '#3B82F6', '#6D28D9', '#E879F9', '#22D3EE', '#F472B6', '#14B8A6'
        ];
        return Array.from({ length: numColors }, (_, i) => colors[i % colors.length]);
    }

    const productDashboardData = {
        'gics': {
            title: "Guaranteed Investment Certificates (GICs)",
            description: "GICs are low-risk investments where you lend money to a financial institution for a set period at a fixed interest rate. Your principal is guaranteed, making them a safe choice for predictable returns.",
            risk: "Very Low",
            fees: "None directly (built into the rate).",
            liquidity: "Low (funds typically locked in for the term, though some 'cashable' options exist with lower rates).",
            diversification: "Limited; provides stability but no exposure to market growth.",
            minInvestment: "Typically $500 - $1,000.",
            howToPurchase: [
                { text: "Directly from major banks (e.g., RBC, TD, BMO, CIBC, Scotiabank).", link: "https://www.rbc.com/investments/gic-rates.html" },
                { text: "Through credit unions (e.g., Vancity, Desjardins).", link: "https://www.desjardins.com/ca/personal/save-invest/guaranteed-investment-certificates/" },
                { text: "Online-only banks (e.g., EQ Bank, Oaken Financial) often offer competitive rates.", link: "https://www.eqbank.ca/personal-banking/gic-rates" },
                { text: "Through discount brokerages (e.g., Questrade, Wealthsimple) where you can access GICs from various issuers.", link: "https://www.wealthsimple.com/en-ca/magazine/gics-wealthsimple" }
            ],
            performingOptions: {
                canada: [
                    "RBC 1-Year Non-Redeemable GIC", "TD 3-Year Fixed Rate GIC", "EQ Bank 5-Year GIC",
                    "Scotiabank 2-Year Step-Up GIC", "BMO 1-Year Cashable GIC", "CIBC 3-Year Escalator GIC",
                    "Simplii Financial 1-Year GIC", "Tangerine 3-Year GIC", "Manulife Bank 5-Year GIC",
                    "Laurentian Bank 1-Year GIC"
                ],
                unitedStates: [
                    "US Bank 1-Year CD", "Chase Bank 3-Year CD", "Ally Bank 5-Year CD",
                    "Capital One 2-Year CD", "Discover Bank 1-Year CD", "Synchrony Bank 3-Year CD",
                    "Goldman Sachs 5-Year CD", "Marcus by Goldman Sachs 1-Year CD", "CIT Bank 3-Year CD",
                    "Barclays Bank 5-Year CD"
                ]
            },
            historicalPerformance: {
                labels: Array.from({length: 20}, (_, i) => 2005 + i),
                canada: {
                    options: [
                        { name: "RBC 1-Year GIC", data: generateSimulatedData(100, 20, 0.2, 2.5) }, // low volatility, steady growth
                        { name: "EQ Bank 5-Year GIC", data: generateSimulatedData(100, 20, 0.1, 2.8) },
                        { name: "TD 3-Year GIC", data: generateSimulatedData(100, 20, 0.15, 2.6) },
                        { name: "Scotiabank 2-Year GIC", data: generateSimulatedData(100, 20, 0.2, 2.4) },
                        { name: "CIBC 4-Year GIC", data: generateSimulatedData(100, 20, 0.1, 2.7) },
                        { name: "BMO 1-Year Cashable", data: generateSimulatedData(100, 20, 0.25, 2.2) },
                        { name: "Simplii 2-Year GIC", data: generateSimulatedData(100, 20, 0.18, 2.5) },
                        { name: "Tangerine 3-Year GIC", data: generateSimulatedData(100, 20, 0.15, 2.65) },
                        { name: "Manulife 5-Year GIC", data: generateSimulatedData(100, 20, 0.12, 2.85) },
                        { name: "National Bank 1-Year", data: generateSimulatedData(100, 20, 0.2, 2.55) }
                    ]
                },
                unitedStates: {
                    options: [
                        { name: "Chase 1-Year CD", data: generateSimulatedData(100, 20, 0.2, 2.4) },
                        { name: "Ally 5-Year CD", data: generateSimulatedData(100, 20, 0.15, 2.7) },
                        { name: "Bank of America 2-Year CD", data: generateSimulatedData(100, 20, 0.2, 2.3) },
                        { name: "Wells Fargo 3-Year CD", data: generateSimulatedData(100, 20, 0.18, 2.5) },
                        { name: "Discover 1-Year CD", data: generateSimulatedData(100, 20, 0.22, 2.45) },
                        { name: "Synchrony 4-Year CD", data: generateSimulatedData(100, 20, 0.1, 2.8) },
                        { name: "Citibank 2-Year CD", data: generateSimulatedData(100, 20, 0.2, 2.35) },
                        { name: "Goldman Sachs 3-Year CD", data: generateSimulatedData(100, 20, 0.16, 2.6) },
                        { name: "PNC Bank 1-Year CD", data: generateSimulatedData(100, 20, 0.23, 2.3) },
                        { name: "Capital One 5-Year CD", data: generateSimulatedData(100, 20, 0.1, 2.9) }
                    ]
                }
            },
            taxImplications: `
                <p><strong>Canadian GICs:</strong> Interest income from GICs held in non-registered accounts is fully taxable in the year it is earned or accrues.</p>
                <p><strong>US Certificates of Deposit (CDs) for Canadian Investors:</strong> Interest income from US CDs is fully taxable in Canada. There is no US withholding tax on interest paid on bank deposits (like CDs) to non-residents, making them tax-efficient in this regard, but they are still fully taxable in Canada. Consider currency exchange rate fluctuations when holding US dollar CDs.</p>
            `,
            newsHighlights: [
                { text: "Canadian Banks Increase GIC Rates Amidst Inflationary Pressures", link: "https://financialpost.com/" },
                { text: "Long-Term GICs Gain Popularity as Interest Rates Stabilize", link: "https://www.wealthprofessional.ca/" },
                { text: "EQ Bank Offers Top Tier GIC Rates for New Deposits", link: "https://www.eqbank.ca/personal-banking/gic-rates" }
            ]
        },
        'mutual-funds': {
            title: "Mutual Funds",
            description: "Mutual Funds are professionally managed collections of investments. They pool money from many investors to buy stocks, bonds, and other securities. While offering diversification and professional management, they typically come with higher fees.",
            risk: "Medium to High (depends on fund's holdings)",
            fees: "Typically 1.5% - 2.5% MER (Management Expense Ratio) annually, plus potential sales charges (loads).",
            liquidity: "Traded once a day, at the end of the market close.",
            diversification: "Offer instant diversification across many securities.",
            minInvestment: "Often require a minimum investment, from a few hundred to thousands of dollars.",
            howToPurchase: [
                { text: "Through a full-service financial advisor at a bank or independent firm.", link: "https://www.rbc.com/investor-relations/find-an-advisor.html" },
                { text: "Directly from mutual fund companies (e.g., Vanguard, Fidelity).", link: "https://www.vanguardcanada.ca/" },
                { text: "Through a discount brokerage, particularly for 'D' or 'F' series funds which have lower fees as they don't include advice (e.g., Questrade, Wealthsimple).", link: "https://www.questrade.com/self-directed-investing" }
            ],
            performingOptions: {
                canada: [
                    "TD Canadian Index Fund – e-Series", "Mawer Canadian Equity Fund", "AGF Global Select Series F",
                    "Fidelity Balanced Portfolio", "CIBC Canadian Bond Fund", "RBC Canadian Equity Fund",
                    "Scotia Canadian Equity Index Fund", "NBI Canadian Index Fund", "Fidelity Canadian Growth Company Fund",
                    "Fidelity Balanced Income Private Pool"
                ],
                unitedStates: [
                    "Vanguard Total Stock Market Index Fund Admiral Shares (VTSAX)", "Fidelity 500 Index Fund (FXAIX)",
                    "Dodge & Cox Stock Fund (DODGX)", "American Funds Growth Fund of America (AGTHX)",
                    "T. Rowe Price Blue Chip Growth Fund (TRBCX)", "Schwab Total Stock Market Index Fund (SWTSX)",
                    "Fidelity Contrafund (FCNTX)", "Vanguard Total International Stock Index Fund (VTIAX)",
                    "PIMCO Income Fund (PONAX)", "Templeton Global Bond Fund (TGBAX)"
                ]
            },
            historicalPerformance: {
                labels: Array.from({length: 20}, (_, i) => 2005 + i),
                canada: {
                    options: [
                        { name: "TD Canadian Index Fund e-Series", data: generateSimulatedData(100, 20, 10, 7) },
                        { name: "Mawer Canadian Equity Fund", data: generateSimulatedData(100, 20, 11, 7.5) },
                        { name: "AGF Global Select Series F", data: generateSimulatedData(100, 20, 12, 8) },
                        { name: "Fidelity Balanced Portfolio", data: generateSimulatedData(100, 20, 8, 6.5) },
                        { name: "CIBC Canadian Bond Fund", data: generateSimulatedData(100, 20, 3, 3.5) },
                        { name: "RBC Canadian Equity Fund", data: generateSimulatedData(100, 20, 9.5, 6.8) },
                        { name: "Scotia Canadian Equity Index", data: generateSimulatedData(100, 20, 9.8, 7.1) },
                        { name: "NBI Canadian Index Fund", data: generateSimulatedData(100, 20, 10.2, 7.2) },
                        { name: "Fidelity Canadian Growth", data: generateSimulatedData(100, 20, 13, 8.2) },
                        { name: "Fidelity Balanced Income", data: generateSimulatedData(100, 20, 5, 5) }
                    ]
                },
                unitedStates: {
                    options: [
                        { name: "Vanguard Total Stock Market (VTSAX)", data: generateSimulatedData(100, 20, 14, 10) },
                        { name: "Fidelity 500 Index (FXAIX)", data: generateSimulatedData(100, 20, 13, 9.8) },
                        { name: "Dodge & Cox Stock (DODGX)", data: generateSimulatedData(100, 20, 15, 10.5) },
                        { name: "American Funds Growth (AGTHX)", data: generateSimulatedData(100, 20, 16, 11) },
                        { name: "T. Rowe Price Blue Chip Growth", data: generateSimulatedData(100, 20, 17, 11.5) },
                        { name: "Schwab Total Stock Market (SWTSX)", data: generateSimulatedData(100, 20, 13.5, 9.9) },
                        { name: "Fidelity Contrafund (FCNTX)", data: generateSimulatedData(100, 20, 15.5, 10.8) },
                        { name: "Vanguard Total International (VTIAX)", data: generateSimulatedData(100, 20, 12, 8.5) },
                        { name: "PIMCO Income Fund (PONAX)", data: generateSimulatedData(100, 20, 4, 4.5) },
                        { name: "Templeton Global Bond (TGBAX)", data: generateSimulatedData(100, 20, 3.5, 4) }
                    ]
                }
            },
            taxImplications: `
                <p><strong>Canadian Mutual Funds:</strong> Income (interest, dividends, capital gains) generated within mutual funds is taxed based on the type of income and the account it's held in. In non-registered accounts, capital gains are 50% taxable, dividends are eligible for dividend tax credits, and interest is fully taxable.</p>
                <p><strong>US Mutual Funds (for Canadian Investors):</strong> If a US mutual fund holds US stocks, dividends are subject to a 15% US withholding tax before reaching your account (in non-registered and TFSA accounts). This tax can generally be recovered or avoided in an RRSP/RRIF due to the Canada-US tax treaty. Capital gains on sale are taxed in Canada.</p>
            `,
            newsHighlights: [
                { text: "Global Equity Mutual Funds See Strong Inflows in Q1 2025", link: "https://financialpost.com/" },
                { text: "Canadian Mutual Fund Industry Adapts to Changing Fee Landscape", link: "https://www.wealthprofessional.ca/" },
                { text: "BMO Mutual Funds Announce Quarterly Distributions", link: "https://newsroom.bmo.com/news/bmo-global-asset-management-announces-etf-and-mutual-fund-distributions" }
            ]
        },
        'etfs': {
            title: "Exchange-Traded Funds (ETFs)",
            description: "ETFs are diversified baskets of investments that trade like individual stocks on a stock exchange. Most ETFs are passively managed, aiming to track a specific index, leading to lower fees and broad market exposure.",
            risk: "Low to High (depends on underlying assets)",
            fees: "Very low, typically 0.05% - 0.50% MER annually. Trading commissions (often $0 at many Canadian brokerages).",
            liquidity: "Traded continuously throughout the trading day, like stocks.",
            diversification: "Offer instant and broad diversification, easy to build a diversified portfolio with a few ETFs.",
            minInvestment: "Can buy a single unit (share), making them accessible for small investments.",
            howToPurchase: [
                { text: "Through a self-directed (discount) brokerage account (e.g., Questrade, Wealthsimple Trade, major bank direct investing platforms).", link: "https://www.questrade.com/self-directed-investing" },
                { text: "Via a robo-advisor (e.g., RBC InvestEase, Wealthsimple Invest) where portfolios are built with ETFs.", link: "https://www.rbcinvestease.com/" },
                { text: "Through a full-service advisor, though they might often package them into managed solutions.", link: "https://www.rbcwealthmanagement.com/en-ca/advisor-search" }
            ],
            performingOptions: {
                canada: [
                    "Vanguard FTSE Canada All Cap Index ETF (VCN)", "iShares Core S&P/TSX 60 Index ETF (XIU)",
                    "BMO Aggregate Bond Index ETF (ZAG)", "Vanguard S&P 500 Index ETF (VFV)",
                    "iShares Core S&P 500 Index ETF (XUS)", "Vanguard All-Equity ETF Portfolio (VEQT)",
                    "Vanguard Balanced ETF Portfolio (VBAL)", "iShares Core Growth ETF Portfolio (XGRO)",
                    "Vanguard FTSE Canadian High Dividend Yield ETF (VDY)", "Purpose High Interest Savings ETF (PSA)"
                ],
                unitedStates: [
                    "Vanguard S&P 500 ETF (VOO)", "Invesco QQQ Trust (QQQ)",
                    "Vanguard Total Stock Market ETF (VTI)", "iShares Core U.S. Aggregate Bond ETF (AGG)",
                    "Vanguard Total Bond Market ETF (BND)", "Technology Select Sector SPDR Fund (XLK)",
                    "Vanguard Growth ETF (VUG)", "Schwab U.S. Dividend Equity ETF (SCHD)",
                    "Vanguard Dividend Appreciation ETF (VIG)", "Vanguard Total International Stock ETF (VXUS)"
                ]
            },
            historicalPerformance: {
                labels: Array.from({length: 20}, (_, i) => 2005 + i),
                canada: {
                    options: [
                        { name: "VCN", data: generateSimulatedData(100, 20, 10, 7) }, // Canadian equities
                        { name: "XIU", data: generateSimulatedData(100, 20, 9.5, 6.8) },
                        { name: "ZAG", data: generateSimulatedData(100, 20, 2.5, 3.2) }, // Canadian bonds
                        { name: "VFV", data: generateSimulatedData(100, 20, 13, 9.5) }, // Canadian-listed US equity
                        { name: "XUS", data: generateSimulatedData(100, 20, 12.8, 9.3) },
                        { name: "VEQT", data: generateSimulatedData(100, 20, 11, 8.5) }, // All-in-one equity
                        { name: "VBAL", data: generateSimulatedData(100, 20, 8, 6.5) }, // All-in-one balanced
                        { name: "XGRO", data: generateSimulatedData(100, 20, 10.5, 8) },
                        { name: "VDY", data: generateSimulatedData(100, 20, 8, 6) }, // Dividend
                        { name: "PSA", data: generateSimulatedData(100, 20, 0.5, 2.8) } // HISA ETF
                    ]
                },
                unitedStates: {
                    options: [
                        { name: "VOO", data: generateSimulatedData(100, 20, 13.5, 9.8) }, // S&P 500
                        { name: "QQQ", data: generateSimulatedData(100, 20, 16, 12) }, // Nasdaq 100
                        { name: "VTI", data: generateSimulatedData(100, 20, 13, 9.5) }, // Total Stock Market
                        { name: "AGG", data: generateSimulatedData(100, 20, 2.8, 3.5) }, // US Aggregate Bonds
                        { name: "BND", data: generateSimulatedData(100, 20, 2.7, 3.4) },
                        { name: "XLK", data: generateSimulatedData(100, 20, 17, 12.5) }, // Technology
                        { name: "VUG", data: generateSimulatedData(100, 20, 15, 11) }, // Growth
                        { name: "SCHD", data: generateSimulatedData(100, 20, 9, 7) }, // Dividend Equity
                        { name: "VIG", data: generateSimulatedData(100, 20, 8.5, 6.8) },
                        { name: "VXUS", data: generateSimulatedData(100, 20, 10, 7.5) } // International
                    ]
                }
            },
            taxImplications: `
                <p><strong>Canadian ETFs:</strong> Taxed similar to mutual funds, depending on the income type and account. Very efficient for holding Canadian and often international equities.</p>
                <p><strong>US ETFs (for Canadian Investors):</strong> US-domiciled ETFs that hold US stocks pay dividends subject to a 15% US withholding tax in non-registered and TFSA accounts. This tax is recoverable in an RRSP/RRIF. If a Canadian-domiciled ETF holds US stocks, there's usually a single layer of 15% withholding tax that cannot be recovered in any account (except specific corporate class ETFs). Always check the ETF's domicile and holdings.</p>
            `,
            newsHighlights: [
                { text: "Canadian ETF Market Continues Rapid Growth in 2025", link: "https://www.bloomberg.com/canada" },
                { text: "Clean Energy ETFs See Renewed Interest Amid Policy Shifts", link: "https://financialpost.com/" },
                { text: "Vanguard Insights: The Role of Fixed Income ETFs in a Balanced Portfolio", link: "https://www.vanguard.ca/individual/insights.htm" }
            ]
        },
        'stocks': {
            title: "Stocks (Equities)",
            description: "A stock represents a share of ownership in a publicly traded company. Investing in individual stocks offers the potential for high returns but comes with higher risk compared to diversified funds.",
            risk: "High (company-specific and market risk)",
            fees: "Trading commissions per trade (can be $0 at many discount brokerages). No MER.",
            liquidity: "Highly liquid, traded continuously throughout market hours.",
            diversification: "Requires significant effort to achieve diversification; ideally hold many stocks across sectors/geographies, or use ETFs.",
            minInvestment: "Can buy a single share (plus commission if applicable). Fractional shares available on some platforms.",
            howToPurchase: [
                { text: "Open a self-directed (discount) brokerage account and place buy orders (e.g., Questrade, Wealthsimple Trade).", link: "https://www.questrade.com/self-directed-investing" },
                { text: "Work with a full-service financial advisor for stock recommendations and management (e.g., RBC Dominion Securities).", link: "https://www.rbcwealthmanagement.com/en-ca/advisor-search" },
                { text: "Use specific apps that allow fractional share investing for smaller amounts (e.g., Wealthsimple Trade).", link: "https://www.wealthsimple.com/en-ca/investing/trade" }
            ],
            performingOptions: {
                canada: [
                    "Royal Bank of Canada (RY)", "Shopify Inc. (SHOP)", "Toronto-Dominion Bank (TD)",
                    "Enbridge Inc. (ENB)", "Brookfield Asset Management (BAM)", "Thomson Reuters Corp (TRI)",
                    "Bank of Montreal (BMO)", "Constellation Software Inc. (CSU)",
                    "Canadian Pacific Kansas City Ltd. (CP)", "Suncor Energy (SU)"
                ],
                unitedStates: [
                    "Microsoft Corp. (MSFT)", "NVIDIA Corp. (NVDA)", "Apple Inc. (AAPL)",
                    "Amazon.com Inc. (AMZN)", "Alphabet Inc. (GOOGL)", "Meta Platforms Inc. (META)",
                    "Eli Lilly and Company (LLY)", "Walmart Inc. (WMT)", "JPMorgan Chase & Co. (JPM)",
                    "Visa Inc. (V)"
                ]
            },
            historicalPerformance: {
                labels: Array.from({length: 20}, (_, i) => 2005 + i),
                canada: {
                    options: [
                        { name: "RY", data: generateSimulatedData(100, 20, 15, 8) },
                        { name: "SHOP", data: generateSimulatedData(100, 20, 30, 15) }, // Higher volatility, higher growth
                        { name: "TD", data: generateSimulatedData(100, 20, 14, 7.8) },
                        { name: "ENB", data: generateSimulatedData(100, 20, 18, 9) },
                        { name: "BAM", data: generateSimulatedData(100, 20, 20, 10) },
                        { name: "TRI", data: generateSimulatedData(100, 20, 16, 8.5) },
                        { name: "BMO", data: generateSimulatedData(100, 20, 13, 7.5) },
                        { name: "CSU", data: generateSimulatedData(100, 20, 25, 12) },
                        { name: "CP", data: generateSimulatedData(100, 20, 17, 9.5) },
                        { name: "SU", data: generateSimulatedData(100, 20, 19, 9.2) }
                    ]
                },
                unitedStates: {
                    options: [
                        { name: "MSFT", data: generateSimulatedData(100, 20, 20, 14) },
                        { name: "NVDA", data: generateSimulatedData(100, 20, 35, 18) }, // Very high growth/volatility
                        { name: "AAPL", data: generateSimulatedData(100, 20, 25, 15) },
                        { name: "AMZN", data: generateSimulatedData(100, 20, 28, 16) },
                        { name: "GOOGL", data: generateSimulatedData(100, 20, 22, 14.5) },
                        { name: "META", data: generateSimulatedData(100, 20, 30, 17) },
                        { name: "LLY", data: generateSimulatedData(100, 20, 20, 13) },
                        { name: "WMT", data: generateSimulatedData(100, 20, 10, 7) }, // Lower volatility
                        { name: "JPM", data: generateSimulatedData(100, 20, 12, 8) },
                        { name: "V", data: generateSimulatedData(100, 20, 18, 12) }
                    ]
                }
            },
            taxImplications: `
                <p><strong>Canadian Stocks:</strong> Capital gains are 50% taxable. Eligible dividends receive a dividend tax credit. Non-eligible dividends are fully taxable. Tax rules depend on the account type (registered vs. non-registered).</p>
                <p><strong>US Stocks (for Canadian Investors):</strong> Dividends from US companies are subject to a 15% US withholding tax when held in non-registered or TFSA accounts. This tax can be avoided if held within an RRSP/RRIF due to the Canada-US tax treaty. Capital gains on US stocks are fully taxable in Canada (50% inclusion rate).</p>
            `,
            newsHighlights: [
                { text: "Canadian Tech Stocks Lead Market Rebound This Week", link: "https://www.reuters.com/markets/canada/" },
                { text: "Energy Sector Sees Boost from Rising Oil Prices", link: "https://www.cbc.ca/news/business" },
                { text: "Bank Earnings Season Kicks Off with Strong Results", link: "https://financialpost.com/category/personal-finance/investing/" }
            ]
        },
        'bonds': {
            title: "Bonds",
            description: "A bond is essentially a loan made by an investor to a borrower (like a government or corporation). In return, the investor receives regular interest payments and the return of their principal at maturity. Generally considered less risky than stocks.",
            risk: "Low to Medium (credit risk of issuer, interest rate risk)",
            fees: "Often minimal direct fees when bought individually. Bond ETFs have low MERs (e.g., 0.05% - 0.20%).",
            liquidity: "Varies; individual bonds can be less liquid than bond ETFs. Bond ETFs are highly liquid.",
            diversification: "Provide stability and income, diversifying against stock market volatility.",
            minInvestment: "Individual bonds can have high minimums ($5,000 - $25,000+). Bond ETFs are highly accessible.",
            howToPurchase: [
                { text: "Directly through a bond desk at a full-service brokerage (for large institutional purchases).", link: "https://www.rbcwealthmanagement.com/en-ca/advisor-search" },
                { text: "Most commonly, through a discount brokerage by purchasing **Bond ETFs** (Exchange-Traded Funds) which hold a diversified portfolio of bonds (e.g., Questrade, Wealthsimple Trade).", link: "https://www.questrade.com/self-directed-investing" },
                { text: "Through bond mutual funds offered by financial institutions (e.g., TD Mutual Funds).", link: "https://www.td.com/ca/en/personal-banking/personal-investing/learn/how-to-invest-in-mutual-funds" }
            ],
            performingOptions: {
                canada: [
                    "Government of Canada 5-Year Bond", "Government of Canada 10-Year Bond",
                    "Ontario Provincial Bond (Example)", "Bell Canada Corporate Bond (Example)",
                    "Enbridge Corporate Bond (Example)", "BMO Aggregate Bond Index ETF (ZAG)",
                    "iShares Core Canadian Universe Bond Index ETF (XBB)", "Vanguard Canadian Aggregate Bond Index ETF (VAB)",
                    "TD Target 2028 Investment Grade Bond ETF (TBCH)", "Hydro One Corporate Bond (Example)"
                ],
                unitedStates: [
                    "US Treasury 10-Year Note", "US Treasury 30-Year Bond",
                    "Vanguard Total Bond Market ETF (BND)", "iShares Core U.S. Aggregate Bond ETF (AGG)",
                    "Vanguard Intermediate-Term Corporate Bond ETF (VCIT)", "iShares iBoxx $ Inv. Grade Corp. Bond ETF (LQD)",
                    "JPMorgan Chase & Co. Corporate Bond (Example)", "Apple Inc. Corporate Bond (Example)",
                    "JPMorgan Ultra-Short Income ETF (JPST)", "SPDR Bloomberg 1-3 Month T-Bill ETF (BIL)"
                ]
            },
            historicalPerformance: {
                labels: Array.from({length: 20}, (_, i) => 2005 + i),
                canada: {
                    options: [
                        { name: "GoC 5-Year Bond", data: generateSimulatedData(100, 20, 1.5, 2.8) },
                        { name: "GoC 10-Year Bond", data: generateSimulatedData(100, 20, 2, 3) },
                        { name: "Ontario Provincial Bond", data: generateSimulatedData(100, 20, 1.8, 3.1) },
                        { name: "Bell Canada Corp Bond", data: generateSimulatedData(100, 20, 2.2, 3.5) },
                        { name: "Enbridge Corp Bond", data: generateSimulatedData(100, 20, 2.5, 3.6) },
                        { name: "ZAG", data: generateSimulatedData(100, 20, 2.7, 3.4) },
                        { name: "XBB", data: generateSimulatedData(100, 20, 2.8, 3.3) },
                        { name: "VAB", data: generateSimulatedData(100, 20, 2.6, 3.2) },
                        { name: "TBCH (TD Target Bond)", data: generateSimulatedData(100, 20, 1.9, 2.9) },
                        { name: "Hydro One Corp Bond", data: generateSimulatedData(100, 20, 2.1, 3.45) }
                    ]
                },
                unitedStates: {
                    options: [
                        { name: "US Treasury 10-Year", data: generateSimulatedData(100, 20, 1.6, 3) },
                        { name: "US Treasury 30-Year", data: generateSimulatedData(100, 20, 2.1, 3.2) },
                        { name: "BND", data: generateSimulatedData(100, 20, 2.9, 3.6) },
                        { name: "AGG", data: generateSimulatedData(100, 20, 3, 3.5) },
                        { name: "VCIT", data: generateSimulatedData(100, 20, 2.3, 3.8) },
                        { name: "LQD", data: generateSimulatedData(100, 20, 2.6, 3.7) },
                        { name: "JPM Corp Bond", data: generateSimulatedData(100, 20, 2.4, 4) },
                        { name: "Apple Corp Bond", data: generateSimulatedData(100, 20, 2.5, 3.9) },
                        { name: "JPST", data: generateSimulatedData(100, 20, 0.8, 2.5) },
                        { name: "BIL", data: generateSimulatedData(100, 20, 0.7, 2.4) }
                    ]
                }
            },
            taxImplications: `
                <p><strong>Canadian Bonds:</strong> Interest income from Bonds is fully taxable in non-registered accounts. Capital gains/losses on bonds are treated as capital gains/losses (50% taxable/deductible).</p>
                <p><strong>US Bonds (for Canadian Investors):</strong> Interest income from US bonds (or bond ETFs) is subject to a 15% US withholding tax in non-registered and TFSA accounts. This tax can be avoided if held in an RRSP/RRIF. Capital gains are taxed in Canada.</p>
            `,
            newsHighlights: [
                { text: "Bank of Canada's Latest Rate Decision Impacts Bond Market", link: "https://www.cbc.ca/news/business" },
                { text: "Corporate Bond Issuance Strong as Companies Seek Funding", link: "https://financialpost.com/" },
                { text: "Inflation Fears Recede, Boosting Long-Term Bond Appeal", link: "https://www.reuters.com/markets/us/bonds/" }
            ]
        }
    };

    // --- Existing Data (Remains Unchanged) ---
    const considerationsData = [
        { icon: '💳', title: 'Social Insurance Number (SIN)', text: 'A valid SIN is required to open any registered investment account in Canada.' },
        { icon: '⚖️', title: 'Risk Tolerance', text: 'Honestly assess your comfort with potential losses. This dictates your investment choices.' },
        { icon: '🗓️', title: 'Investment Horizon', text: 'When do you need the money? Long-term goals can handle more risk than short-term ones.' },
        { icon: '🧺', title: 'Diversification', text: "Don't put all your eggs in one basket. Spread investments across different assets and geographies." },
        { icon: '💰', title: 'Fees', text: 'Be mindful of fees! Even small percentages significantly erode returns over time.' },
        { icon: '📈', title: 'Compounding', text: 'Start early to let your returns earn returns, growing your wealth exponentially.' },
        { icon: '📚', title: 'Financial Literacy', text: 'Continuously learn about investing. Knowledge is your best tool.' },
        { icon: '🔥', title: 'Inflation', text: 'Investing helps your money grow faster than the rate of inflation, preserving your purchasing power.' },
        { icon: '🆘', title: 'Emergency Fund', text: 'Before investing, secure 3-6 months of living expenses in an easily accessible savings account.' },
        { icon: '🇨🇦', title: 'Tax Residency', text: 'Understand your status as a Canadian resident for tax purposes, as it affects your eligibility.' }
    ];

    const recommendationData = `
        <h3 class="text-xl font-bold mb-4">A Suggested Path to Get Started</h3>
        <p class="mb-4">For most newcomers, the best approach is to prioritize flexibility and tax efficiency. Here’s a recommended order of operations:</p>
        <ol class="list-decimal list-inside space-y-4">
            <li>
                <span class="font-semibold">Build an Emergency Fund:</span> Before anything else, save 3-6 months of living expenses in a High-Interest Savings Account (HISA).
            </li>
            <li>
                <span class="font-semibold">Maximize your FHSA (if applicable):</span> If buying a home in Canada is a goal, the FHSA offers an unparalleled combination of a tax deduction on contributions and tax-free withdrawals for a home purchase. This should be your first priority.
            </li>
            <li>
                <span class="font-semibold">Maximize your TFSA:</span> The tax-free growth and flexible, tax-free withdrawals make the TFSA an incredibly powerful and versatile tool for any goal. It's often wise to fill this before an RRSP, especially if you expect your income to rise in the future.
            </li>
            <li>
                <span class="font-semibold">Contribute to your RRSP:</span> Once the TFSA/FHSA is maxed out, or if you are in a high tax bracket now, contributing to your RRSP is a great way to save for retirement and get a significant tax deduction.
            </li>
        </ol>
        <h3 class="text-xl font-bold mt-6 mb-4">How to Start Investing?</h3>
        <p>For the investment management style, starting with a <strong>Robo-Advisor like RBC InvestEase</strong> is highly recommended. It's simple, low-cost, and ensures your portfolio is professionally managed and diversified from day one, removing the guesswork and stress of doing it yourself.</p>
    `;

    // --- DOM Element Selection ---
    const accountsGrid = document.getElementById('accounts-grid');
    const productsContainer = document.getElementById('investment-products');
    const managementContainer = document.getElementById('management-styles');
    const detailedProductsList = document.getElementById('detailed-products-list'); // This element is effectively removed/unused now
    const recommendationContent = document.getElementById('recommendation-content');
    const comparisonTableContainer = document.getElementById('comparison-table-container');
    const infographicGrid = document.getElementById('infographic-grid'); // Infographic grid

    const tabs = document.querySelectorAll('[data-tab]');
    const contentSections = document.querySelectorAll('.content-section');
    const chartToggleButtons = document.querySelectorAll('.chart-toggle-btn');
    const glossaryInput = document.getElementById('glossary-input');
    const explainButton = document.getElementById('explain-btn');
    const glossaryOutput = document.getElementById('glossary-output');
    const loadingSpinner = document.getElementById('loading-spinner');
    const darkModeToggle = document.getElementById('dark-mode-toggle'); // Dark Mode Toggle Button

    // Product Details Dashboard elements
    const productDashboardNav = document.querySelector('.product-dashboard-nav');
    const productDashboardContent = document.getElementById('product-dashboard-content');


    // --- Disclaimer Elements ---
    const disclaimerModal = document.getElementById('disclaimer-modal');
    const acknowledgeButton = document.getElementById('acknowledge-disclaimer');
    const mainAppContent = document.getElementById('main-app-content');

    // Declare comparisonChart here to make it globally accessible
    let comparisonChart;

    // Declare productCharts to store chart instances for product dashboard
    const productCharts = {};

    // --- Dark Mode State Management ---
    let isDarkMode = (sessionStorage.getItem('isDarkMode') === 'true'); // Load from session storage

    // Function to apply/remove dark mode class on body
    function applyDarkModeClass() {
        if (isDarkMode) {
            document.body.classList.remove('light-mode');
        } else {
            document.body.classList.add('light-mode');
        }
        updateDarkModeToggleIcon(); // Update the icon and its colors
    }

    // Function to update the dark mode toggle button's icon and styling
    function updateDarkModeToggleIcon() {
        if (darkModeToggle) {
            darkModeToggle.innerHTML = isDarkMode ? `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="2" stroke="currentColor" class="w-6 h-6">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.364l-1.591 1.591M21 12h-2.25m-.364 6.364l-1.591-1.591M12 21v-2.25m-6.364-.364l1.591-1.591M3 12H5.25m-.364-6.364l1.591 1.591M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                </svg>
            ` : `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="2" stroke="currentColor" class="w-6 h-6">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.718 9.718 0 0112 21.75c-3.617 0-6.945-1.847-8.86-4.732a9.718 9.718 0 0117.72-3.049z" />
                </svg>
            `;
            // Apply Tailwind classes directly based on mode
            darkModeToggle.classList.remove('bg-gray-700', 'text-yellow-400', 'bg-gray-200', 'text-indigo-700');
            darkModeToggle.classList.add(isDarkMode ? 'bg-gray-700' : 'bg-gray-200');
            darkModeToggle.classList.add(isDarkMode ? 'text-yellow-400' : 'text-indigo-700');
        }
    }

    // Toggles dark mode state, saves to session, and re-renders UI
    function toggleDarkMode() {
        isDarkMode = !isDarkMode;
        sessionStorage.setItem('isDarkMode', isDarkMode.toString());
        initializeUI(); // Re-initialize the whole UI with the new theme
        // Ensure the active tab's content is also re-rendered with the new theme
        const activeTabElement = document.querySelector('.tab-active');
        if (activeTabElement) {
            const currentTabId = activeTabElement.dataset.tab;
            showContentSection(currentTabId); // Re-show the active section to refresh its elements
        }
    }

    // Attach dark mode toggle listener
    if (darkModeToggle) {
        darkModeToggle.addEventListener('click', toggleDarkMode);
    }

    // --- Initial Load Logic with Disclaimer ---
    if (sessionStorage.getItem('disclaimerAcknowledged') === 'true') {
        disclaimerModal.style.display = 'none';
        mainAppContent.style.display = 'block';
    } else {
        disclaimerModal.style.display = 'flex';
        mainAppContent.style.display = 'none';
    }

    acknowledgeButton.addEventListener('click', () => {
        sessionStorage.setItem('disclaimerAcknowledged', 'true');
        disclaimerModal.style.display = 'none';
        mainAppContent.style.display = 'block';
    });

    // --- Functions for Dynamic Content Rendering ---

    // Define showContentSection function in the parent scope of initializeUI
    function showContentSection(tabId) {
        contentSections.forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');

        tabs.forEach(tab => {
            // Remove all specific styling classes related to active/inactive states and borders
            tab.classList.remove(
                'tab-active', 'tab-inactive', // General state classes
                'border-b-2', 'border-indigo-500', 'text-indigo-400', 'bg-gray-700', // Dark active
                'border-transparent', 'text-gray-400', 'hover:text-white', 'hover:bg-gray-700', // Dark inactive
                'border-blue-500', 'text-blue-600', 'bg-blue-50', // Light active
                'text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100' // Light inactive
            );

            if (tab.dataset.tab === tabId) {
                tab.classList.add('tab-active');
                if (isDarkMode) {
                    tab.classList.add('border-b-2', 'border-indigo-500', 'text-indigo-400', 'bg-gray-700');
                } else {
                    tab.classList.add('border-b-2', 'border-blue-500', 'text-blue-600', 'bg-blue-50');
                }
            } else {
                tab.classList.add('tab-inactive');
                if (isDarkMode) {
                    tab.classList.add('border-b-2', 'border-transparent', 'text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                } else {
                    tab.classList.add('border-b-2', 'border-transparent', 'text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
                }
            }
        });

        // Specific re-rendering for chart section when its tab is activated
        if (tabId === 'accounts-and-compare') {
            // Default to 'contribution' on tab switch, and trigger button click styling
            const defaultButton = document.querySelector('.chart-toggle-btn[data-type="contribution"]');
            if (defaultButton) {
                // Manually trigger click to ensure logic runs and styling applies
                defaultButton.click();
            } else {
                 // Fallback if button isn't immediately found (unlikely with DOMContentLoaded)
                renderComparisonChart('contribution', isDarkMode);
            }
            renderComparisonTable(isDarkMode);

        } else if (tabId === 'ai-glossary') {
            // Attach correct event listeners and apply styles for glossary
            explainButton.removeEventListener('click', explainTerm); // Remove old listener to prevent duplicates
            explainButton.addEventListener('click', () => explainTerm(isDarkMode)); // Add new listener with mode
            glossaryInput.removeEventListener('keypress', (e) => { if (e.key === 'Enter') explainTerm(); }); // Remove old
            glossaryInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') explainTerm(isDarkMode); }); // Add new

            const glossarySection = document.getElementById('ai-glossary');
            const glossaryContainer = glossarySection.querySelector('div[class*="bg-"]'); // Select the div with any background class
            if (glossaryContainer) {
                const sectionBgClass = isDarkMode ? 'bg-gray-800' : 'bg-white';
                const sectionBorderClass = isDarkMode ? 'border-gray-700' : 'border-gray-100';
                const sectionShadowClasses = isDarkMode ? ['shadow-indigo-500/10'] : ['shadow-blue-100/50'];
                const inputBgClass = isDarkMode ? 'bg-gray-700' : 'bg-white';
                const inputBorderClass = isDarkMode ? 'border-gray-600' : 'border-gray-300';
                const inputTextColorClass = isDarkMode ? 'text-white' : 'text-gray-800';
                const inputPlaceholderClass = isDarkMode ? 'placeholder-gray-400' : 'placeholder-gray-500';
                const inputFocusRingClass = isDarkMode ? 'focus:ring-indigo-500' : 'focus:ring-gray-500';
                const buttonBgClass = isDarkMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-gray-700 hover:bg-gray-800';
                const outputBgClass = isDarkMode ? 'bg-gray-700' : 'bg-gray-50';
                const outputBorderClass = isDarkMode ? 'border-gray-600' : 'border-gray-200';
                const outputTextColorClass = isDarkMode ? 'text-gray-200' : 'text-gray-700';
                const spinnerBorderTopColorClass = isDarkMode ? 'border-t-indigo-400' : 'border-t-blue-500';

                // Remove all previous background, border, shadow, text colors
                glossaryContainer.className = 'p-6 rounded-lg shadow-xl'; // Reset to base classes
                sectionShadowClasses.forEach(cls => glossaryContainer.classList.add(cls)); // Add classes individually
                glossaryContainer.classList.add(sectionBgClass, sectionBorderClass);

                glossaryInput.className = `flex-grow p-3 border ${inputBorderClass} rounded-lg ${inputBgClass} ${inputTextColorClass} focus:outline-none focus:ring-2 ${inputFocusRingClass} ${inputPlaceholderClass}`;
                explainButton.className = `ml-4 ${buttonBgClass} text-white py-3 px-6 rounded-lg shadow flex items-center justify-center`;
                loadingSpinner.style.borderTopColor = spinnerBorderTopColorClass.split('-').pop();
                glossaryOutput.className = `p-4 ${outputBgClass} rounded-lg border ${outputBorderClass} min-h-[100px] ${outputTextColorClass}`;
                if (glossaryOutput.textContent.trim() === 'Your explanation will appear here.') {
                    glossaryOutput.innerHTML = `<p class="text-center ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}">Your explanation will appear here.</p>`;
                }
            }
        } else if (tabId === 'explore-investments') {
            // Render the default product dashboard content (e.g., GICs, as it's the first button now)
            renderProductDashboard('gics', isDarkMode);
            // Ensure the correct product tab is highlighted
            productDashboardNav.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('active-product-tab');
                if (btn.dataset.product === 'gics') {
                    btn.classList.add('active-product-tab');
                }
            });
            // Re-render investment products and management styles within 'explore-investments'
            renderInvestmentProducts(isDarkMode);
            renderManagementStyles(isDarkMode);
        }
    }


    function renderAccountCards(mode) {
        accountsGrid.innerHTML = ''; // Clear existing cards
        for (const key in accountData) {
            const account = accountData[key];
            const card = document.createElement('div');
            const cardBgClass = mode ? 'linear-gradient(135deg, #1F2937 0%, #2D3748 100%)' : 'linear-gradient(135deg, #FFFFFF 0%, #E0E7FF 100%)';
            const cardBorderClass = mode ? 'border-gray-700' : 'border-blue-200';
            const cardShadowClasses = mode ? ['shadow-indigo-500/10', 'hover:shadow-indigo-500/20'] : ['shadow-blue-200/50', 'hover:shadow-blue-300/50']; // Split for add()
            const titleColorClass = mode ? 'text-indigo-400' : 'text-indigo-700';
            const fullNameColorClass = mode ? 'text-gray-200' : 'text-gray-600';
            const purposeColorClass = mode ? 'text-gray-400' : 'text-gray-700';

            card.className = `account-card p-6 shadow-md transition-all duration-300 transform hover:-translate-y-2 cursor-pointer`;
            cardShadowClasses.forEach(cls => card.classList.add(cls)); // Add classes individually
            card.style.background = cardBgClass;
            card.style.border = `1px solid ${mode ? '#374151' : '#BFDBFE'}`;
            card.innerHTML = `
                <h3 class="text-2xl font-bold ${titleColorClass} mb-2">${account.title}</h3>
                <p class="${fullNameColorClass} mb-2">${account.fullName}</p>
                <p class="${purposeColorClass} text-sm">${account.purpose}</p>
            `;
            card.addEventListener('click', () => showDetailsModal(account, 'account', mode));
            accountsGrid.appendChild(card);
        }
    }

    function createAccordionItem(title, content, mode) {
        const div = document.createElement('div');
        const itemBgClass = mode ? 'bg-gray-800' : 'bg-white';
        const itemBorderClass = mode ? 'border-gray-700' : 'border-gray-200';
        const titleColorClass = mode ? 'text-gray-100' : 'text-gray-700';
        const arrowColorClass = mode ? 'text-indigo-400' : 'text-gray-500';
        const contentTextColorClass = mode ? 'text-gray-300' : 'text-gray-600';

        div.className = `border-b ${itemBorderClass} ${itemBgClass} transition-all duration-300 accordion-item`;
        div.innerHTML = `
            <button class="w-full text-left py-4 px-2 focus:outline-none">
                <div class="flex justify-between items-center">
                    <span class="font-semibold text-lg ${titleColorClass}">${title}</span>
                    <span class="transform transition-transform duration-300 ${arrowColorClass}">▼</span>
                </div>
            </button>
            <div class="accordion-content px-2 pb-4 ${contentTextColorClass}">
                ${content}
            </div>
        `;
        const button = div.querySelector('button');
        const contentDiv = div.querySelector('.accordion-content');
        const arrow = div.querySelector('span:last-child');

        button.addEventListener('click', () => {
            if (contentDiv.style.maxHeight) {
                contentDiv.style.maxHeight = null;
                arrow.style.transform = 'rotate(0deg)';
            } else {
                document.querySelectorAll('.accordion-content').forEach(otherContent => {
                    if (otherContent !== contentDiv) {
                        otherContent.style.maxHeight = null;
                        const otherArrow = otherContent.previousElementSibling.querySelector('span:last-child');
                        if (otherArrow) otherArrow.style.transform = 'rotate(0deg)';
                    }
                });
                contentDiv.style.maxHeight = contentDiv.scrollHeight + "px";
                arrow.style.transform = 'rotate(180deg)';
            }
        });
        return div;
    }

    function renderInvestmentProducts(mode) {
        productsContainer.innerHTML = `<h3 class="text-2xl font-bold mb-4 text-center ${mode ? 'text-white' : 'text-gray-900'}">Investment Products</h3>`;
        productData.forEach(item => {
            const accordionItem = createAccordionItem(item.title, item.description, mode);
            productsContainer.appendChild(accordionItem);
        });
    }

    function renderManagementStyles(mode) {
        managementContainer.innerHTML = `<h3 class="text-2xl font-bold mb-4 text-center ${mode ? 'text-white' : 'text-gray-900'}">Management Styles</h3>`;
        managementData.forEach(item => {
            const accordionItem = createAccordionItem(item.title, item.description, mode);
            managementContainer.appendChild(accordionItem);
        });
    }

    // `detailedProductData` and `createProductCard` are no longer directly used in the main flow
    // as `product-details-dashboard` is now the primary "deep dive" view.
    // Keeping `detailedProductData` for reference, but `renderDetailedProducts` is removed.

    function renderRecommendationContent(mode) {
        const textColorClass = mode ? 'text-gray-200' : 'text-gray-700';
        const sectionBgClass = mode ? 'bg-gray-800' : 'bg-white';
        const sectionBorderClass = mode ? 'border-gray-700' : 'border-gray-100';
        const sectionShadowClasses = mode ? ['shadow-xl', 'shadow-indigo-500/10'] : ['shadow-lg', 'shadow-blue-100/50']; // Split for add()
        const accentColorClass = mode ? 'text-indigo-400' : 'text-gray-800';

        // Update the parent div's classes for the recommendation section
        const recommendationParentDiv = recommendationContent.parentElement;
        recommendationParentDiv.classList.remove('bg-white', 'p-8', 'rounded-lg', 'shadow-lg', 'border', 'border-gray-100'); // Remove old classes
        // Ensure all individual classes are removed before adding new ones
        recommendationParentDiv.classList.remove('shadow-xl', 'shadow-indigo-500/10', 'shadow-lg', 'shadow-blue-100/50');
        recommendationParentDiv.classList.add('p-8', 'rounded-lg'); // Consistent core styling
        sectionShadowClasses.forEach(cls => recommendationParentDiv.classList.add(cls)); // Add classes individually
        recommendationParentDiv.classList.add(sectionBgClass);
        recommendationParentDiv.classList.add(sectionBorderClass);

        const updatedRecommendationData = recommendationData
            .replace(/<h3 class="text-xl font-bold mb-4">/g, `<h3 class="text-xl font-bold mb-4 ${accentColorClass}">`)
            .replace(/<span class="font-semibold">/g, `<span class="font-semibold ${accentColorClass}">`)
            .replace(/<strong class="font-semibold">/g, `<strong class="font-semibold ${accentColorClass}">`)
            .replace(/<p class="mb-4">/g, `<p class="mb-4 ${textColorClass}">`)
            .replace(/<p>/g, `<p class="${textColorClass}">`)
            .replace(/<span class="font-semibold">/g, `<span class="font-semibold ${accentColorClass}">`);


        recommendationContent.innerHTML = `<div class="${textColorClass}">${updatedRecommendationData}</div>`;
    }

    function renderInfographicGrid(mode) {
        infographicGrid.innerHTML = ''; // Clear existing cards
        considerationsData.forEach(item => {
            const infographicCard = document.createElement('div');
            const cardBgClass = mode ? 'linear-gradient(135deg, #1F2937 0%, #2D3748 100%)' : 'linear-gradient(to bottom right, #FFFFFF, #EBF8FF)';
            const cardBorderClass = mode ? 'border-gray-700' : 'border-blue-200';
            const cardShadowClasses = mode ? ['shadow-indigo-500/10', 'hover:shadow-indigo-500/20'] : ['shadow-blue-200/50', 'hover:shadow-blue-300/50']; // Split for add()
            const iconColorClass = mode ? 'text-indigo-400' : 'text-60A5FA';
            const titleColorClass = mode ? 'text-gray-100' : 'text-374151';
            const textColorClass = mode ? 'text-gray-300' : 'text-4B5563';

            infographicCard.className = `infographic-card p-6`; // Removed existing shadow class from here
            cardShadowClasses.forEach(cls => infographicCard.classList.add(cls)); // Add classes individually
            infographicCard.style.background = cardBgClass;
            infographicCard.style.border = `1px solid ${mode ? '#374151' : '#BFDBFE'}`;
            infographicCard.innerHTML = `
                <div class="icon ${iconColorClass}">${item.icon}</div>
                <h4 class="${titleColorClass}">${item.title}</h4>
                <p class="${textColorClass}">${item.text}</p>
            `;
            infographicGrid.appendChild(infographicCard);
        });

        // Update the parent section's header and paragraph
        const infographicSection = document.getElementById('investing-principles'); // Now named 'investing-principles'
        if (infographicSection) {
            const header = infographicSection.querySelector('h2');
            const paragraph = infographicSection.querySelector('p');

            header.classList.remove('text-white', 'text-gray-900');
            header.classList.add(mode ? 'text-white' : 'text-gray-900');

            paragraph.classList.remove('text-gray-300', 'text-gray-600');
            paragraph.classList.add(mode ? 'text-gray-300' : 'text-gray-600');
        }
    }

    function showDetailsModal(data, type, mode) {
        const existingModal = document.getElementById('detail-modal');
        if (existingModal) existingModal.remove();

        const modal = document.createElement('div');
        modal.id = 'detail-modal';
        modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50';

        const modalBgClass = mode ? 'bg-gray-800' : 'bg-white';
        const modalBorderClass = mode ? 'border-gray-700' : 'border-gray-100';
        const modalShadowClasses = mode ? ['shadow-indigo-500/20'] : ['shadow-blue-200/50']; // Split for add()
        const titleColorClass = mode ? 'text-indigo-400' : (type === 'account' ? 'text-indigo-700' : 'text-gray-800');
        const textColorClass = mode ? 'text-gray-200' : 'text-gray-800';
        const subtitleColorClass = mode ? 'text-gray-300' : 'text-gray-500';
        const featureBgClass = mode ? 'bg-gray-700' : 'bg-blue-50';
        const featureBorderClass = mode ? 'border-indigo-600' : 'border-blue-200';
        const featureTitleColorClass = mode ? 'text-indigo-400' : 'text-indigo-800';
        const featureTextColorClass = mode ? 'text-gray-200' : 'text-blue-700';
        const closeButtonBgClass = mode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-gray-700 hover:bg-gray-800';
        const closeButtonTextColorClass = 'text-white';

        let modalContentHTML = '';
        if (type === 'account') {
            modalContentHTML = `
                <h2 class="text-3xl font-bold ${titleColorClass} mb-1">${data.title}</h2>
                <p class="${subtitleColorClass} text-lg mb-4">${data.fullName}</p>
                <p class="text-lg ${textColorClass} mb-6">${data.purpose}</p>

                <div class="space-y-4 mb-6">
                    ${data.details.map(d => `
                        <div>
                            <h4 class="font-semibold ${textColorClass}">${d.title}</h4>
                            <p class="${subtitleColorClass}">${d.text}</p>
                        </div>
                    `).join('')}
                </div>

                ${data.features.length > 0 ? `
                <div class="${featureBgClass} p-4 rounded-lg border ${featureBorderClass}">
                    <h4 class="font-semibold text-lg ${featureTitleColorClass} mb-2">Key Feature(s)</h4>
                    ${data.features.map(f => `
                        <div class="mt-2">
                             <p class="${featureTextColorClass}"><strong class="font-medium">${f.title}:</strong> ${f.text}</p>
                        </div>
                    `).join('')}
                </div>` : ''}
            `;
        } else if (type === 'product') {
            modalContentHTML = `
                <h2 class="text-3xl font-bold ${titleColorClass} mb-4">${data.title}</h2>
                <div class="${textColorClass} text-base space-y-4">${data.content}</div>
            `;
        }

        const modalContentDiv = document.createElement('div');
        modalContentDiv.className = `${modalBgClass} rounded-lg shadow-2xl p-8 max-w-3xl w-full relative modal-content border ${modalBorderClass}`;
        modalShadowClasses.forEach(cls => modalContentDiv.classList.add(cls)); // Add classes individually

        modalContentDiv.innerHTML = `
            <button id="close-modal" class="absolute top-4 right-4 ${mode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-800'} text-2xl font-bold transition-colors">&times;</button>
            ${modalContentHTML}
            <button id="close-modal-bottom" class="mt-8 ${closeButtonBgClass} ${closeButtonTextColorClass} py-2 px-4 rounded-lg shadow-md transition-colors">Close</button>
        `;
        modal.appendChild(modalContentDiv);
        document.body.appendChild(modal);

        setTimeout(() => {
            modalContentDiv.classList.add('show');
        }, 10);

        const closeModal = () => {
            modalContentDiv.classList.remove('show');
            modalContentDiv.addEventListener('transitionend', () => modal.remove(), { once: true });
        };

        modal.addEventListener('click', (e) => {
            if (e.target.id === 'detail-modal' || e.target.id === 'close-modal' || e.target.id === 'close-modal-bottom') {
                closeModal();
            }
        });
        document.getElementById('close-modal').addEventListener('click', closeModal);
        document.getElementById('close-modal-bottom').addEventListener('click', closeModal);
    }


    function renderComparisonChart(type, mode) {
        const ctx = document.getElementById('comparisonChart').getContext('2d');
        const labels = ['FHSA', 'RRSP', 'TFSA'];
        let data, chartLabel, yAxisLabel, ticksCallback, yAxisMin, yAxisMax, yAxisStepSize;
        let backgroundColors, borderColors;

        const formatCurrency = (value) => `$${value.toLocaleString()}`;

        if (type === 'contribution') {
            data = [1, 1, 0];
            chartLabel = "Are Contributions Tax-Deductible?";
            yAxisLabel = 'Deductible';
            backgroundColors = mode ? ['rgba(99, 102, 241, 0.7)', 'rgba(99, 102, 241, 0.7)', 'rgba(248, 113, 113, 0.7)'] : ['rgba(110, 231, 183, 0.7)', 'rgba(110, 231, 183, 0.7)', 'rgba(252, 165, 165, 0.7)'];
            borderColors = mode ? ['#6366F1', '#6366F1', '#F87171'] : ['#34D399', '#34D399', '#F87171'];
            ticksCallback = function(value) {
                if (value === 1) return 'Yes';
                if (value === 0) return 'No';
                return '';
            };
            yAxisMin = 0;
            yAxisMax = 1;
            yAxisStepSize = 1;

        } else if (type === 'withdrawal') {
            data = [1, 0, 1];
            chartLabel = "Are Withdrawals Tax-Free?";
            yAxisLabel = 'Tax-Free';
            backgroundColors = mode ? ['rgba(99, 102, 241, 0.7)', 'rgba(248, 113, 113, 0.7)', 'rgba(99, 102, 241, 0.7)'] : ['rgba(110, 231, 183, 0.7)', 'rgba(252, 165, 165, 0.7)', 'rgba(110, 231, 183, 0.7)'];
            borderColors = mode ? ['#6366F1', '#F87171', '#6366F1'] : ['#34D399', '#F87171', '#34D399'];
            ticksCallback = function(value) {
                if (value === 1) return 'Yes';
                if (value === 0) return 'No';
                return '';
            };
            yAxisMin = 0;
            yAxisMax = 1;
            yAxisStepSize = 1;
        } else if (type === 'annual-limit') {
            data = [
                accountData.fhsa.annualContributionLimit,
                accountData.rrsp.annualContributionLimit,
                accountData.tfsa.annualContributionLimit
            ];
            chartLabel = "Annual Contribution Limits (2024)";
            yAxisLabel = 'Amount ($)';
            backgroundColors = mode ? ['rgba(96, 165, 250, 0.7)', 'rgba(129, 140, 248, 0.7)', 'rgba(167, 139, 250, 0.7)'] : ['rgba(147, 197, 253, 0.7)', 'rgba(165, 180, 252, 0.7)', 'rgba(196, 181, 253, 0.7)'];
            borderColors = mode ? ['#60A5FA', '#818CF8', '#A78BFA'] : ['#60A5FA', '#818CF8', '#A78BFA'];
            ticksCallback = function(value) {
                return formatCurrency(value);
            };
            yAxisMin = 0; // Let Chart.js determine max based on data
            yAxisMax = undefined;
            yAxisStepSize = undefined;
        }


        if (comparisonChart) {
            comparisonChart.destroy();
        }

        comparisonChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: yAxisLabel,
                    data: data,
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 1,
                    borderRadius: 8, // Rounded bars
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: chartLabel,
                        font: { size: 20, weight: 'bold' },
                        color: mode ? '#E5E7EB' : '#374151',
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (type === 'contribution' || type === 'withdrawal') {
                                    return context.raw === 1 ? 'Yes' : 'No';
                                } else if (type === 'annual-limit') {
                                    return context.label + ': ' + formatCurrency(context.raw);
                                }
                                return context.raw;
                            },
                        },
                        backgroundColor: mode ? 'rgba(55, 65, 81, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                        titleColor: mode ? '#E5E7EB' : '#374151',
                        bodyColor: mode ? '#D1D5DB' : '#4B5563',
                    },
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        min: yAxisMin, // Added for 'contribution' and 'withdrawal'
                        max: yAxisMax, // Added for 'contribution' and 'withdrawal'
                        ticks: {
                            callback: ticksCallback,
                            stepSize: yAxisStepSize, // Added for 'contribution' and 'withdrawal'
                            font: { size: 12 },
                            color: mode ? '#9CA3AF' : '#6B7280',
                        },
                        grid: {
                            color: mode ? 'rgba(75, 85, 99, 0.5)' : 'rgba(209, 213, 219, 0.5)',
                        },
                        title: {
                            display: true,
                            text: yAxisLabel,
                            font: { size: 14, weight: 'bold' },
                            color: mode ? '#D1D5DB' : '#4B5563',
                        },
                    },
                    x: {
                        ticks: {
                            font: { size: 12 },
                            color: mode ? '#9CA3AF' : '#6B7280',
                        },
                        grid: {
                            color: mode ? 'rgba(75, 85, 99, 0.5)' : 'rgba(209, 213, 219, 0.5)',
                        },
                    },
                },
            }
        });

        // Update chart container background
        const chartContainerDiv = document.querySelector('#accounts-and-compare > div.bg-white, #accounts-and-compare > div.bg-gray-800'); // Select either light or dark background
        if (chartContainerDiv) {
            chartContainerDiv.classList.remove('bg-white', 'bg-gray-800', 'p-6', 'rounded-lg', 'shadow-md', 'border', 'border-gray-100'); // Remove old classes
            // Ensure all individual classes are removed before adding new ones
            chartContainerDiv.classList.remove('shadow-xl', 'shadow-indigo-500/10', 'shadow-lg', 'shadow-blue-100/50');
            chartContainerDiv.classList.add('p-6', 'rounded-lg', 'shadow-xl');
            chartContainerDiv.classList.add(mode ? 'bg-gray-800' : 'bg-white');
            chartContainerDiv.classList.add(mode ? 'border-gray-700' : 'border-gray-100');
            chartContainerDiv.classList.add(mode ? 'shadow-indigo-500/10' : 'shadow-blue-100/50');
        }
    }

    function renderComparisonTable(mode) {
        const table = document.createElement('table');
        const tableHeaderColorClass = mode ? 'text-indigo-400' : 'text-gray-700';
        const tableHeaderBgClass = mode ? 'bg-gray-700' : 'bg-gray-50';
        const tableBorderColor = mode ? '#374151' : '#E5E7EB';
        const tableCellBgClass = mode ? 'bg-gray-800' : 'bg-white';
        const tableOddRowBgClass = mode ? 'bg-gray-900' : 'bg-gray-50';
        const tableHoverBgClass = mode ? 'bg-gray-700' : 'bg-gray-100';
        const tableTextColorClass = mode ? 'text-gray-100' : 'text-gray-800';

        table.className = `comparison-table`;
        table.innerHTML = `
            <thead>
                <tr>
                    <th class="${tableHeaderColorClass} ${tableHeaderBgClass}">Feature</th>
                    <th class="${tableHeaderColorClass} ${tableHeaderBgClass}">FHSA</th>
                    <th class="${tableHeaderColorClass} ${tableHeaderBgClass}">RRSP</th>
                    <th class="${tableHeaderColorClass} ${tableHeaderBgClass}">TFSA</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Primary Purpose</td>
                    <td>First Home Down Payment</td>
                    <td>Retirement Savings</td>
                    <td>Flexible Savings (Any Goal)</td>
                </tr>
                <tr>
                    <td>Contribution Deductible?</td>
                    <td>Yes</td>
                    <td>Yes</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td>Growth Tax Treatment</td>
                    <td>Tax-Free</td>
                    <td>Tax-Deferred</td>
                    <td>Tax-Free</td>
                </tr>
                <tr>
                    <td>Withdrawals Taxable?</td>
                    <td>No (for qualifying home)</td>
                    <td>Yes (as income)</td>
                    <td>No (always)</td>
                </tr>
                <tr>
                    <td>Annual Contribution Limit (2024)</td>
                    <td>$8,000</td>
                    <td>18% of prior year's earned income (max $31,560)</td>
                    <td>$7,000</td>
                </tr>
                <tr>
                    <td>Lifetime Contribution Limit</td>
                    <td>$40,000</td>
                    <td>Based on unused room (variable)</td>
                    <td>Cumulative (e.g., $95,000 as of 2024)</td>
                </tr>
                <tr>
                    <td>Withdrawal Flexibility</td>
                    <td>High (for home purchase)</td>
                    <td>Limited (taxable, HBP/LLP exceptions)</td>
                    <td>High (tax-free, re-contribution next year)</td>
                </tr>
                <tr>
                    <td>Age Limit/Expiry</td>
                    <td>15 years or age 71</td>
                    <td>Must convert by age 71</td>
                    <td>None</td>
                </tr>
                <tr>
                    <td>Impact on Gov. Benefits</td>
                    <td>None (contributions reduce taxable income)</td>
                    <td>Withdrawals may impact clawbacks</td>
                    <td>No impact</td>
                </tr>
            </tbody>
        `;
        comparisonTableContainer.innerHTML = '';
        comparisonTableContainer.appendChild(table);

        const tableRows = table.querySelectorAll('tbody tr');
        tableRows.forEach((row, index) => {
            const cells = row.querySelectorAll('td');
            cells.forEach(cell => {
                cell.classList.add(tableTextColorClass);
                cell.style.borderColor = tableBorderColor;
            });
            // Apply base background
            cells.forEach(cell => cell.classList.add(tableCellBgClass));

            if (index % 2 !== 0) { // Odd rows (0-indexed)
                cells.forEach(cell => {
                    cell.classList.remove(tableCellBgClass); // Remove base if odd
                    cell.classList.add(tableOddRowBgClass);
                });
            }
            // Add hover effect
            row.addEventListener('mouseenter', () => {
                cells.forEach(cell => cell.classList.add(tableHoverBgClass));
            });
            row.addEventListener('mouseleave', () => {
                cells.forEach(cell => cell.classList.remove(tableHoverBgClass));
            });
        });

        const tableParentDiv = document.querySelector('#accounts-and-compare > div.bg-white:last-of-type, #accounts-and-compare > div.bg-gray-800:last-of-type');
        if (tableParentDiv) {
            tableParentDiv.classList.remove('bg-white', 'bg-gray-800', 'p-6', 'rounded-lg', 'shadow-md', 'border', 'border-gray-100'); // Remove old classes
            // Ensure all individual classes are removed before adding new ones
            tableParentDiv.classList.remove('shadow-xl', 'shadow-indigo-500/10', 'shadow-lg', 'shadow-blue-100/50');
            tableParentDiv.classList.add('p-6', 'rounded-lg', 'shadow-xl');
            tableParentDiv.classList.add(mode ? 'bg-gray-800' : 'bg-white');
            tableParentDiv.classList.add(mode ? 'border-gray-700' : 'border-gray-100');
            tableParentDiv.classList.add(mode ? 'shadow-indigo-500/10' : 'shadow-blue-100/50');
        }

        const h3Element = tableParentDiv.querySelector('h3');
        if(h3Element) {
            h3Element.classList.remove('text-white', 'text-gray-900');
            h3Element.classList.add(mode ? 'text-white' : 'text-gray-900');
        }
    }

    async function explainTerm(mode) {
        const term = glossaryInput.value.trim();
        if (!term) {
            glossaryOutput.innerHTML = `<p class="text-center ${mode ? 'text-red-400' : 'text-red-500'}">Please enter a term to explain.</p>`;
            return;
        }

        glossaryOutput.innerHTML = '';
        loadingSpinner.classList.remove('hidden');
        explainButton.disabled = true;

        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: `Explain "${term}" in simple terms for a newcomer to Canada. Focus on its relevance to Canadian investing. Keep it concise, around 3-4 sentences.` }] });
        const payload = { contents: chatHistory };
        const apiKey = ""
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                glossaryOutput.innerHTML = `<p>${text}</p>`;
            } else {
                glossaryOutput.innerHTML = `<p class="text-center ${mode ? 'text-red-400' : 'text-red-500'}">Sorry, I could not generate an explanation for that term.</p>`;
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            glossaryOutput.innerHTML = `<p class="text-center ${mode ? 'text-red-400' : 'text-red-500'}">An error occurred. Please try again later.</p>`;
        } finally {
            loadingSpinner.classList.add('hidden');
            explainButton.disabled = false;
        }
    }

    // NEW: Render Product Dashboard Function
    function renderProductDashboard(productType, mode) {
        const product = productDashboardData[productType];
        if (!product) return;

        // Clear existing content and destroy old charts
        productDashboardContent.innerHTML = '';
        for (const chartId in productCharts) {
            if (productCharts[chartId]) {
                productCharts[chartId].destroy();
                delete productCharts[chartId];
            }
        }

        const textColorClass = mode ? 'text-gray-200' : 'text-gray-700';
        const titleColorClass = mode ? 'text-indigo-400' : 'text-blue-600';
        const strongColorClass = mode ? 'text-white' : 'text-gray-800';

        const dashboardHTML = `
            <div class="product-info-card shadow-lg">
                <h3 class="text-3xl">${product.title}</h3>
                <p class="${textColorClass} mb-4">${product.description}</p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                    <div><strong class="${strongColorClass}">Risk Level:</strong> <span class="${textColorClass}">${product.risk}</span></div>
                    <div><strong class="${strongColorClass}">Typical Fees:</strong> <span class="${textColorClass}">${product.fees}</span></div>
                    <div><strong class="${strongColorClass}">Liquidity:</strong> <span class="${textColorClass}">${product.liquidity}</span></div>
                    <div><strong class="${strongColorClass}">Diversification:</strong> <span class="${textColorClass}">${product.diversification}</span></div>
                    <div><strong class="${strongColorClass}">Min. Investment:</strong> <span class="${textColorClass}">${product.minInvestment}</span></div>
                </div>

                <h3 class="text-2xl mt-8">Historical Performance (Illustrative)</h3>
                <p class="${textColorClass} mb-4 text-sm"><em>This chart uses simulated data to demonstrate typical performance trends. Actual past performance is not an indicator of future results.</em></p>
                <div class="product-chart-wrapper">
                    <div class="w-full">
                        <h4 class="${strongColorClass} text-xl text-center mb-2">Canadian Options</h4>
                        <div class="chart-container-product-details">
                            <canvas id="${productType}CanadaChart"></canvas>
                        </div>
                    </div>
                    <div class="w-full">
                        <h4 class="${strongColorClass} text-xl text-center mb-2">United States Options</h4>
                        <div class="chart-container-product-details">
                            <canvas id="${productType}USChart"></canvas>
                        </div>
                    </div>
                </div>


                <h3 class="text-2xl mt-8">Popular Canadian Options</h3>
                <ul class="list-disc list-inside ml-4 space-y-2 ${textColorClass} mb-8">
                    ${product.performingOptions.canada.map(option => `<li>${option}</li>`).join('')}
                </ul>

                <h3 class="text-2xl mt-8">Popular United States Options</h3>
                <ul class="list-disc list-inside ml-4 space-y-2 ${textColorClass} mb-8">
                    ${product.performingOptions.unitedStates.map(option => `<li>${option}</li>`).join('')}
                </ul>

                <h3 class="text-2xl mt-8">Tax Implications for Canadian Investors</h3>
                <div class="${textColorClass} mb-8">
                    ${product.taxImplications}
                </div>

                <h3 class="text-2xl mt-8">How to Purchase</h3>
                <ol class="list-decimal list-inside ml-4 space-y-2 ${textColorClass} mb-8">
                    ${product.howToPurchase.map(step => `<li><a href="${step.link}" target="_blank" class="${mode ? 'text-blue-300 hover:text-blue-200' : 'text-blue-600 hover:text-blue-800'} underline">${step.text}</a></li>`).join('')}
                </ol>

                <h3 class="text-2xl mt-8">Weekly Highlights & News</h3>
                <p class="${textColorClass} mb-4 text-sm"><em>This section provides illustrative news headlines. For real-time news, an external financial news API would be required. Links lead to general news sources.</em></p>
                <div class="space-y-4">
                    ${product.newsHighlights.map(news => `
                        <div class="news-item">
                            <h4 class="${strongColorClass}">${news.text.split(':')[0].trim()}</h4>
                            <p><a href="${news.link}" target="_blank" class="${mode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-600 hover:text-gray-800'} underline">${news.text.split(':')[1] ? news.text.split(':')[1].trim() : ''} (Source)</a></p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

        productDashboardContent.innerHTML = dashboardHTML;

        // Generate dynamic colors for charts
        const canadaColors = getChartColors(product.historicalPerformance.canada.options.length);
        const usColors = getChartColors(product.historicalPerformance.unitedStates.options.length);

        // Prepare datasets for Canadian chart
        const canadianDatasets = product.historicalPerformance.canada.options.map((option, index) => ({
            label: option.name,
            data: option.data,
            borderColor: canadaColors[index],
            backgroundColor: canadaColors[index] + '33', // 20% opacity
            tension: 0.3,
            fill: false,
            pointRadius: 1 // Smaller points
        }));

        // Render Canadian chart
        const ctxCanada = document.getElementById(`${productType}CanadaChart`).getContext('2d');
        const gridColor = mode ? 'rgba(75, 85, 99, 0.5)' : 'rgba(209, 213, 219, 0.5)';
        const textColor = mode ? '#D1D5DB' : '#4B5563';

        productCharts[`${productType}CanadaChart`] = new Chart(ctxCanada, {
            type: 'line',
            data: {
                labels: product.historicalPerformance.labels, // Use shared labels
                datasets: canadianDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: textColor,
                            font: { size: 10 } // Smaller font for legend
                        }
                    },
                    tooltip: {
                        backgroundColor: mode ? 'rgba(55, 65, 81, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                        titleColor: mode ? '#E5E7EB' : '#374151',
                        bodyColor: mode ? '#D1D5DB' : '#4B5563',
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.raw.toFixed(2); // Format to 2 decimal places
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { color: gridColor }, ticks: { color: textColor } },
                    y: {
                        beginAtZero: true,
                        grid: { color: gridColor },
                        ticks: {
                            callback: function(value) { return value.toFixed(0); }, // Format Y-axis without %
                            color: textColor
                        }
                    }
                }
            }
        });

        // Prepare datasets for US chart
        const usDatasets = product.historicalPerformance.unitedStates.options.map((option, index) => ({
            label: option.name,
            data: option.data,
            borderColor: usColors[index],
            backgroundColor: usColors[index] + '33', // 20% opacity
            tension: 0.3,
            fill: false,
            pointRadius: 1 // Smaller points
        }));

        // Render US chart
        const ctxUS = document.getElementById(`${productType}USChart`).getContext('2d');

        productCharts[`${productType}USChart`] = new Chart(ctxUS, {
            type: 'line',
            data: {
                labels: product.historicalPerformance.labels, // Use shared labels
                datasets: usDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: textColor,
                            font: { size: 10 } // Smaller font for legend
                        }
                    },
                    tooltip: {
                        backgroundColor: mode ? 'rgba(55, 65, 81, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                        titleColor: mode ? '#E5E7EB' : '#374151',
                        bodyColor: mode ? '#D1D5DB' : '#4B5563',
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.raw.toFixed(2);
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { color: gridColor }, ticks: { color: textColor } },
                    y: {
                        beginAtZero: true,
                        grid: { color: gridColor },
                        ticks: {
                            callback: function(value) { return value.toFixed(0); },
                            color: textColor
                        }
                    }
                }
            }
        });
    }

    // --- Main UI Initialization Function ---
    function initializeUI() {
        // Apply initial dark mode class
        applyDarkModeClass();

        // Update header background based on mode
        const headerElement = document.querySelector('header');
        if (headerElement) {
            headerElement.classList.remove('bg-stone-50', 'text-gray-800', 'shadow-md', 'shadow-gray-200/50', 'bg-gray-950', 'text-gray-100', 'shadow-xl', 'shadow-gray-900/30'); // Remove potential conflicting classes

            headerElement.style.background = isDarkMode
                ? 'linear-gradient(to right, #1A2235, #121827)'
                : 'linear-gradient(to right, #E0F7FA, #FFFFFF)';
            
            // Re-add classes as individual tokens
            const headerShadowClasses = isDarkMode ? ['shadow-xl', 'shadow-gray-900/30'] : ['shadow-md', 'shadow-gray-200/50'];
            headerShadowClasses.forEach(cls => headerElement.classList.add(cls));

            headerElement.querySelector('h1').classList.remove('text-white', 'text-gray-900');
            headerElement.querySelector('h1').classList.add(isDarkMode ? 'text-white' : 'text-gray-900');
            headerElement.querySelector('p').classList.remove('text-gray-400', 'text-gray-600');
            headerElement.querySelector('p').classList.add(isDarkMode ? 'text-gray-400' : 'text-gray-600');
        }

        // Update nav and footer based on mode
        const navElement = document.querySelector('nav');
        if (navElement) {
            navElement.classList.remove('bg-gray-800', 'border-gray-700', 'shadow-lg', 'shadow-gray-900/20', 'bg-white', 'border-gray-200', 'shadow-md', 'shadow-gray-200/20');
            navElement.classList.add(isDarkMode ? 'bg-gray-800' : 'bg-white');
            navElement.classList.add(isDarkMode ? 'border-gray-700' : 'border-gray-200');
            
            // Re-add classes as individual tokens
            const navShadowClasses = isDarkMode ? ['shadow-lg', 'shadow-gray-900/20'] : ['shadow-md', 'shadow-gray-200/20'];
            navShadowClasses.forEach(cls => navElement.classList.add(cls));


            tabs.forEach(tab => {
                // Remove all specific styling classes related to active/inactive states and borders
                tab.classList.remove(
                    'tab-active', 'tab-inactive', // General state classes
                    'border-b-2', 'border-indigo-500', 'text-indigo-400', 'bg-gray-700', // Dark active
                    'border-transparent', 'text-gray-400', 'hover:text-white', 'hover:bg-gray-700', // Dark inactive
                    'border-blue-500', 'text-blue-600', 'bg-blue-50', // Light active
                    'text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100' // Light inactive
                );

                const isActive = tab.dataset.tab === document.querySelector('.content-section.active')?.id;
                if (isActive) {
                    tab.classList.add('tab-active');
                    if (isDarkMode) {
                        tab.classList.add('border-b-2', 'border-indigo-500', 'text-indigo-400', 'bg-gray-700');
                    } else {
                        tab.classList.add('border-b-2', 'border-blue-500', 'text-blue-600', 'bg-blue-50');
                    }
                } else {
                    tab.classList.add('tab-inactive');
                    if (isDarkMode) {
                        tab.classList.add('border-b-2', 'border-transparent', 'text-gray-400', 'hover:text-white', 'hover:bg-gray-700');
                    } else {
                        tab.classList.add('border-b-2', 'border-transparent', 'text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
                    }
                }
            });
        }

        const footerElement = document.querySelector('footer');
        if (footerElement) {
            footerElement.classList.remove('bg-gray-900', 'border-gray-800', 'text-gray-500', 'bg-gray-100', 'border-gray-200', 'text-gray-600');
            footerElement.classList.add(isDarkMode ? 'bg-gray-900' : 'bg-gray-100');
            footerElement.classList.add(isDarkMode ? 'border-gray-800' : 'border-gray-200');
            footerElement.classList.add(isDarkMode ? 'text-gray-500' : 'text-gray-600');
        }

        // Update disclaimer modal colors
        const disclaimerContent = document.getElementById('disclaimer-modal-content');
        if (disclaimerContent) {
            disclaimerContent.classList.remove('bg-gray-800', 'border-gray-700', 'bg-white', 'border-gray-200'); // Remove old classes
            // Ensure all individual classes are removed before adding new ones
            disclaimerContent.classList.remove('shadow-indigo-500/20', 'shadow-blue-100/50');

            disclaimerContent.classList.add(isDarkMode ? 'bg-gray-800' : 'bg-white');
            disclaimerContent.classList.add(isDarkMode ? 'border-gray-700' : 'border-gray-200');
            
            const disclaimerShadowClasses = isDarkMode ? ['shadow-indigo-500/20'] : ['shadow-blue-100/50'];
            disclaimerShadowClasses.forEach(cls => disclaimerContent.classList.add(cls));


            disclaimerContent.querySelector('h2').classList.remove('text-indigo-400', 'text-gray-900');
            disclaimerContent.querySelector('h2').classList.add(isDarkMode ? 'text-indigo-400' : 'text-gray-900');

            disclaimerContent.querySelectorAll('p').forEach(p => {
                p.classList.remove('text-gray-300', 'text-gray-700');
                p.classList.add(isDarkMode ? 'text-gray-300' : 'text-gray-700');
            });

            const disclaimerButton = disclaimerContent.querySelector('button');
            disclaimerButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'bg-blue-600', 'hover:bg-blue-700');
            disclaimerButton.classList.add(isDarkMode ? 'bg-indigo-600' : 'bg-blue-600');
            disclaimerButton.classList.add(isDarkMode ? 'hover:bg-indigo-700' : 'hover:bg-blue-700');
        }

        // Render all dynamic content with the current theme
        renderAccountCards(isDarkMode);
        // Products and management styles are now rendered within 'explore-investments'
        // renderInvestmentProducts(isDarkMode); // Removed from here
        // renderManagementStyles(isDarkMode); // Removed from here
        // renderDetailedProducts(isDarkMode); // Removed, as product-dashboard takes over

        renderRecommendationContent(isDarkMode);
        renderInfographicGrid(isDarkMode); // For the new infographic page (now on id="investing-principles")

        // Update section headers and paragraphs for all sections
        contentSections.forEach(section => {
            const h2 = section.querySelector('h2');
            const p = section.querySelector('p');
            if (h2) {
                h2.classList.remove('text-white', 'text-gray-900');
                h2.classList.add(isDarkMode ? 'text-white' : 'text-gray-900');
            }
            if (p) {
                p.classList.remove('text-gray-300', 'text-gray-600');
                p.classList.add(isDarkMode ? 'text-gray-300' : 'text-gray-600');
            }
        });


        // Ensure chart is re-rendered if its tab is active
        const activeTabElement = document.querySelector('.tab-active');
        if (activeTabElement) {
            const currentTab = activeTabElement.dataset.tab;
            if (currentTab === 'accounts-and-compare') {
                // Ensure the chart buttons are handled correctly
                const defaultButton = document.querySelector('.chart-toggle-btn[data-type="contribution"]');
                if (defaultButton) {
                    // Manually trigger click to ensure logic runs and styling applies
                    defaultButton.click();
                } else {
                    // Fallback if button isn't immediately found (unlikely with DOMContentLoaded)
                    renderComparisonChart('contribution', isDarkMode);
                }
                renderComparisonTable(isDarkMode);

            } else if (currentTab === 'ai-glossary') {
                // Attach correct event listeners and apply styles for glossary
                explainButton.removeEventListener('click', explainTerm); // Remove old listener to prevent duplicates
                explainButton.addEventListener('click', () => explainTerm(isDarkMode)); // Add new listener with mode
                glossaryInput.removeEventListener('keypress', (e) => { if (e.key === 'Enter') explainTerm(); }); // Remove old
                glossaryInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') explainTerm(isDarkMode); }); // Add new

                const glossarySection = document.getElementById('ai-glossary');
                const glossaryContainer = glossarySection.querySelector('div[class*="bg-"]'); // Select the div with any background class
                if (glossaryContainer) {
                    const sectionBgClass = isDarkMode ? 'bg-gray-800' : 'bg-white';
                    const sectionBorderClass = isDarkMode ? 'border-gray-700' : 'border-gray-100';
                    const sectionShadowClasses = isDarkMode ? ['shadow-indigo-500/10'] : ['shadow-blue-100/50'];
                    const inputBgClass = isDarkMode ? 'bg-gray-700' : 'bg-white';
                    const inputBorderClass = isDarkMode ? 'border-gray-600' : 'border-gray-300';
                    const inputTextColorClass = isDarkMode ? 'text-white' : 'text-gray-800';
                    const inputPlaceholderClass = isDarkMode ? 'placeholder-gray-400' : 'placeholder-gray-500';
                    const inputFocusRingClass = isDarkMode ? 'focus:ring-indigo-500' : 'focus:ring-gray-500';
                    const buttonBgClass = isDarkMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-gray-700 hover:bg-gray-800';
                    const outputBgClass = isDarkMode ? 'bg-gray-700' : 'bg-gray-50';
                    const outputBorderClass = isDarkMode ? 'border-gray-600' : 'border-gray-200';
                    const outputTextColorClass = isDarkMode ? 'text-gray-200' : 'text-gray-700';
                    const spinnerBorderTopColorClass = isDarkMode ? 'border-t-indigo-400' : 'border-t-blue-500';

                    // Remove all previous background, border, shadow, text colors
                    glossaryContainer.className = 'p-6 rounded-lg shadow-xl'; // Reset to base classes
                    sectionShadowClasses.forEach(cls => glossaryContainer.classList.add(cls)); // Add classes individually
                    glossaryContainer.classList.add(sectionBgClass, sectionBorderClass);

                    glossaryInput.className = `flex-grow p-3 border ${inputBorderClass} rounded-lg ${inputBgClass} ${inputTextColorClass} focus:outline-none focus:ring-2 ${inputFocusRingClass} ${inputPlaceholderClass}`;
                    explainButton.className = `ml-4 ${buttonBgClass} text-white py-3 px-6 rounded-lg shadow flex items-center justify-center`;
                    loadingSpinner.style.borderTopColor = spinnerBorderTopColorClass.split('-').pop();
                    glossaryOutput.className = `p-4 ${outputBgClass} rounded-lg border ${outputBorderClass} min-h-[100px] ${outputTextColorClass}`;
                    if (glossaryOutput.textContent.trim() === 'Your explanation will appear here.') {
                        glossaryOutput.innerHTML = `<p class="text-center ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}">Your explanation will appear here.</p>`;
                    }
                }
            } else if (currentTab === 'explore-investments') {
                renderProductDashboard(productDashboardNav.querySelector('.active-product-tab')?.dataset.product || 'gics', isDarkMode);
            }
        }
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            showContentSection(tab.dataset.tab);
        });
    });

    // Chart Toggle Buttons Event Listener
    chartToggleButtons.forEach(button => {
        button.addEventListener('click', () => {
            const chartType = button.dataset.type;
            // Remove active styling from all buttons
            chartToggleButtons.forEach(btn => {
                btn.classList.remove('bg-gray-700', 'hover:bg-gray-800', 'bg-blue-600', 'hover:bg-blue-700');
                btn.classList.add('bg-gray-400', 'hover:bg-gray-500'); // Default inactive style
            });

            // Add active styling to the clicked button
            if (isDarkMode) {
                button.classList.remove('bg-gray-400', 'hover:bg-gray-500');
                button.classList.add('bg-gray-700', 'hover:bg-gray-800');
            } else {
                button.classList.remove('bg-gray-400', 'hover:bg-gray-500');
                button.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }
            renderComparisonChart(chartType, isDarkMode);
        });
    });

    // Event listener for product dashboard navigation
    productDashboardNav.addEventListener('click', (event) => {
        const targetButton = event.target.closest('button');
        if (targetButton && targetButton.dataset.product) {
            productDashboardNav.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('active-product-tab');
                // Re-apply basic non-active styling if needed based on mode
                if (isDarkMode) {
                    btn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600', 'hover:text-white');
                } else {
                    btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200', 'hover:text-gray-900');
                }
            });

            targetButton.classList.add('active-product-tab');
            // Re-apply active styling based on mode
            if (isDarkMode) {
                targetButton.classList.add('bg-indigo-600', 'text-white', 'shadow-md', 'shadow-indigo-500/30');
            } else {
                targetButton.classList.add('bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-500/30');
            }

            renderProductDashboard(targetButton.dataset.product, isDarkMode);
        }
    });

    // Initial UI render when DOM is ready
    initializeUI();
    // Set initial active tab (e.g., 'accounts')
    showContentSection('accounts-and-compare'); // Set the initial active tab to the new merged Accounts tab
});
</script>

</body>
</html>